<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Randomise/UserGuide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">Randomise/UserGuide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./Randomise.html">Introduction</a></li><li>User Guide<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#USING_randomise">USING randomise</a><ol><li>
<a href="#Viewing_and_Reporting_Results">Viewing and Reporting Results</a></li><li>
<a href="#Parallelising_Randomise">Parallelising Randomise</a></li></ol></li><li>
<a href="#Examples">Examples</a><ol><li>
<a href="#One-Sample_T-test">One-Sample T-test</a></li><li>
<a href="#Two-Sample_Unpaired_T-test">Two-Sample Unpaired T-test</a></li><li>
<a href="#Two-Sample_Unpaired_T-test_with_nuisance_variables">Two-Sample Unpaired T-test with nuisance variables</a></li><li>
<a href="#Two-Sample_Paired_T-test_.28Paired_Two-Group_Difference.29">Two-Sample Paired T-test (Paired Two-Group Difference)</a></li><li>
<a href="#Repeated_measures_ANOVA">Repeated measures ANOVA</a></li><li>
<a href="#Getting_Cluster_and_Peak_Information_from_Randomise_Output">Getting Cluster and Peak Information from Randomise Output</a></li></ol></li><li>
<a href="#Two-pass_mode">Two-pass mode</a></li><li>
<a href="#Associated_Tools">Associated Tools</a><ol><li>
<a href="#Lesion_Masking">Lesion Masking</a></li></ol></li></ol></div></div></li><li><a href="./Randomise(2f)Theory.html">Theory</a></li><li><a href="./Randomise(2f)Faq.html">FAQ</a></li></ol></div> <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-5"></span>
<h1 id="USING_randomise">USING randomise</h1>
<span class="anchor" id="line-6"></span><p class="line862">A typical simple call to <strong>randomise</strong> uses the following syntax: <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867"><tt class="backtick">randomise&nbsp;-i&nbsp;&lt;4D_input_data&gt;&nbsp;-o&nbsp;&lt;output_rootname&gt;&nbsp;-d&nbsp;design.mat&nbsp;-t&nbsp;design.con&nbsp;-m&nbsp;&lt;mask_image&gt;&nbsp;-n&nbsp;500&nbsp;-D&nbsp;-T</tt> <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line867"><tt class="backtick">design.mat</tt> and <tt class="backtick">design.con</tt> are text files containing the design matrix and list of contrasts required; they follow the same format as generated by FEAT (see below for examples). The <tt class="backtick">-n&nbsp;500</tt> option tells <strong>randomise</strong> to generate 500 permutations of the data when building up the null distribution to test against. The <tt class="backtick">-D</tt> option tells randomise to demean the data before continuing - this is necessary if you are not modelling the mean in the design matrix. The <tt class="backtick">-T</tt> option tells <strong>randomise</strong> that the test statistic that you wish to use is TFCE (threshold-free cluster enhancement - see below for more on this). <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line862">When using the demeaning option, <tt class="backtick">-D</tt>, randomise will also demean the EVs in the design matrix, providing a warning if they initially had non-zero mean (and as long as this doesn't cause the matrix/contrasts to become rank deficient then this warning can be ignored). <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line862">There are two programs that make it easy to create the design matrix, contrast and exchangeability-block files <tt class="backtick">design.mat</tt> / <tt class="backtick">design.con</tt> / <tt class="backtick">design.grp</tt> . The first is the Glm GUI which allows the specification of designs in the same way as in FEAT, and the second is a simple script to allow you to easily generate design files for the two-group unpaired t-test case, called design_ttest2. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line867"><strong>randomise</strong> has the following thresholding/output options: <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><ul><li><p class="line862">Voxel-based thresholding, both uncorrected and corrected for multiple comparisons by using the null distribution of the max (across the image) voxelwise test statistic. Uncorrected outputs are: <tt class="backtick">&lt;output&gt;_vox_p_tstat</tt> / <tt class="backtick">&lt;output&gt;_vox_p_fstat</tt>. Corrected outputs are: <tt class="backtick">&lt;output&gt;_vox_corrp_tstat</tt> / <tt class="backtick">&lt;output&gt;_vox_corrp_fstat</tt>. To use this option, use <tt class="backtick">-x</tt>. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span></li><li class="gap"><p class="line862">TFCE (Threshold-Free Cluster Enhancement) is a new method for finding "clusters" in your data without having to define clusters in a binary way. Cluster-like structures are enhanced but the image remains fundamentally voxelwise; you can use the <tt class="backtick">-tfce</tt> option in <tt class="backtick">fslmaths</tt> to test this on an existing stats image. See the TFCE research page for more information. The "E", "H" and neighbourhood-connectivity parameters have been optimised and should be left unchanged. These optimisations are different for different "dimensionality" of your data; for normal, 3D data (such as in an FSL-VBM analysis), you should just just the <tt class="backtick">-T</tt> option, while for TBSS analyses (that is in effect on the mostly "2D" white matter skeleton), you should use the <tt class="backtick">--T2</tt> option. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></li><li class="gap"><p class="line862">Cluster-based thresholding corrected for multiple comparisons by using the null distribution of the max (across the image) cluster size (so passé!): <tt class="backtick">&lt;output&gt;_clustere_corrp_tstat</tt> / <tt class="backtick">&lt;output&gt;_clustere_corrp_fstat</tt>. <br>
 To use this option, use <tt class="backtick">-c&nbsp;&lt;thresh&gt;</tt> for t contrasts and <tt class="backtick">-F&nbsp;&lt;thresh&gt;</tt> for F contrasts, where the threshold is used to form supra-threshold clusters of voxels. <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span></li><li class="gap"><p class="line862">Cluster-based thresholding corrected for multiple comparisons by using the null distribution of the max (across the image) cluster mass: <tt class="backtick">&lt;output&gt;_clusterm_corrp_tstat</tt> / <tt class="backtick">&lt;output&gt;_clusterm_corrp_fstat</tt>. <br>
To use this option, use <tt class="backtick">-C&nbsp;&lt;thresh&gt;</tt> for t contrasts and <tt class="backtick">-S&nbsp;&lt;thresh&gt;</tt> for F contrasts. <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span></li></ul><p class="line874">These filename extensions are summarized in table below. <span class="anchor" id="line-27"></span><div><table><tbody><tr>  <td colspan="1" rowspan="2" style="text-align:center"><p class="line862"> </td>
  <td colspan="1" rowspan="2" style="text-align:center"><p class="line862">Voxel-wise </td>
  <td colspan="1" rowspan="2" style="text-align:center"><p class="line862">TFCE </td>
  <td colspan="2" style="text-align:center"><p class="line862">Cluster-wise </td>
</tr>
<tr>  <td><span class="anchor" id="line-28"></span><p class="line862">Extent </td>
  <td><p class="line862">Mass </td>
</tr>
<tr>  <td><span class="anchor" id="line-29"></span><p class="line862">Raw test statistic </td>
  <td><p class="line891"><tt class="backtick">_tstat</tt><br>
<tt class="backtick">_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">_tfce_tstat</tt><br>
<tt class="backtick">_tfce_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">n/a</tt> </td>
  <td><p class="line891"><tt class="backtick">n/a</tt> </td>
</tr>
<tr>  <td><span class="anchor" id="line-30"></span><p class="line862">1 - Uncorrected P </td>
  <td><p class="line891"><tt class="backtick">_vox_p_tstat</tt><br>
<tt class="backtick">_vox_p_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">_tfce_p_tstat</tt><br>
<tt class="backtick">_tfce_p_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">n/a</tt> </td>
  <td><p class="line891"><tt class="backtick">n/a</tt> </td>
</tr>
<tr>  <td><span class="anchor" id="line-31"></span><p class="line862">1 - FWE-Corrected P </td>
  <td><p class="line891"><tt class="backtick">_vox_corrp_tstat</tt><br>
<tt class="backtick">_vox_corrp_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">_tfce_corrp_tstat</tt><br>
<tt class="backtick">_tfce_corrp_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">_clustere_corrp_tstat</tt><br>
<tt class="backtick">_clustere_corrp_fstat</tt> </td>
  <td><p class="line891"><tt class="backtick">_clusterm_corrp_tstat_</tt><br>
<tt class="backtick">_clusterm_corrp_tstat_</tt> </td>
</tr>
</tbody></table></div><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><p class="line874">"FWE-corrected" means that the family-wise error rate is controlled. If only FWE-corrected P-values less than 0.05 are accepted, the chance of one more false positives occurring over space space is no more than 5%. Equivalently, one has 95% confidence of no false positives in the image. <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><p class="line862">Note that these output images are 1-P images, where a value of 1 is therefore most significant (arranged this way to make display and thresholding convenient). Thus to "threshold at p&lt;0.01", threshold the output images at 0.99 etc. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line862">If your design is simply all 1s (for example, a single group of subjects) then randomise needs to work in a different way. Normally it generates random samples by randomly permuting the rows of the design; however in this case it does so by randomly inverting the sign of the 1s. In this case, then, instead of specifying design and contrast matrices on the command line, use the <tt class="backtick">-1</tt> option. <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line862">You can potentially improve the estimation of the variance that feeds into the final "t" statistic image by using the variance smoothing option <tt class="backtick">-v&nbsp;&lt;std&gt;</tt> where you need to specify the spatial extent of the smoothing in mm. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line867">
<h2 id="Viewing_and_Reporting_Results">Viewing and Reporting Results</h2>
<span class="anchor" id="line-45"></span><p class="line862">When viewing the 1-p results in FSLView the min/max display range should be set to 0.95/1.0 so that values less than 0.95 (equivalent to p&gt;0.05) are not shown.  If these are corrected values (i.e. corrp) then the visible areas correspond to the statistically significant regions. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">To report cluster results (size, maxima, locations, labels) you can use the <a href="./Cluster.html#reporting">cluster</a> and <a href="./Atlasquery.html">atlasquery</a> tools. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line867">
<h2 id="Parallelising_Randomise">Parallelising Randomise</h2>
<span class="anchor" id="line-50"></span><p class="line862">If you are have an SGE-capable system then a <strong>randomise</strong> job can be split in parallel with <tt class="backtick">randomise_parallel</tt> which takes the same input options as the standard randomise binary and then calculates and batches an optimal number of <strong>randomise</strong> sub-tasks. The parallelisation has two stages - firstly the <strong>randomise</strong> sub-jobs are run, and then the sub-job results are combined in the final output. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line867">
<h1 id="Examples">Examples</h1>
<span class="anchor" id="line-53"></span><p class="line867">
<h2 id="One-Sample_T-test">One-Sample T-test</h2>
<span class="anchor" id="line-54"></span><p class="line862">To perform a nonparametric 1-sample t-test (e.g., on COPEs created by FEAT FMRI analysis), create a 4D image of all of the images. There should be no repeated measures, i.e., there should only be one image per subject. Because this is a single group simple design you don't need a design matrix or contrasts. Just use:<br>
 <tt class="backtick">randomise&nbsp;-i&nbsp;OneSamp4D&nbsp;-o&nbsp;OneSampT&nbsp;-1&nbsp;-T</tt><br>
 Note you do not need the <tt class="backtick">-D</tt> option (as the mean is in the model), and omit the -n option, so that 5000 permutations will be performed. <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line862">If you have fewer than 20 subjects (approx. 20 DF), then you will usually see an increase in power by using variance smoothing, as in<br>
 <tt class="backtick">randomise&nbsp;-i&nbsp;OneSamp4D&nbsp;-o&nbsp;OneSampT&nbsp;-1&nbsp;-v&nbsp;5&nbsp;-T</tt><br>
 which does a 5mm HWHM variance smoothing. <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line874">Note also that randomise will automatically select one-sample mode for appropriate design/contrast combinations. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867">
<h2 id="Two-Sample_Unpaired_T-test">Two-Sample Unpaired T-test</h2>
<span class="anchor" id="line-61"></span><p class="line862">To perform a nonparametric 2-sample t-test, create 4D image of all of the images, with the subjects in the right order! Create appropriate <tt class="backtick">design.mat</tt> and <tt class="backtick">design.con</tt> files. <span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line862">Once you have your design files run:<br>
 <tt class="backtick">randomise&nbsp;-i&nbsp;TwoSamp4D&nbsp;-o&nbsp;TwoSampT&nbsp;-d&nbsp;design.mat&nbsp;-t&nbsp;design.con&nbsp;-m&nbsp;mask&nbsp;-T&nbsp;</tt> <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line867">
<h2 id="Two-Sample_Unpaired_T-test_with_nuisance_variables">Two-Sample Unpaired T-test with nuisance variables</h2>
<span class="anchor" id="line-66"></span><p class="line862">To perform a nonparametric 2-sample t-test in the presence of nuisance variables, create a 4D image of all of the images. Create appropriate <tt class="backtick">design.mat</tt> and <tt class="backtick">design.con</tt> files, where your design matrix has additional nuisance variables that are (appropriately) ignored by your contrast. <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line862">Once you have your design files the call is as before:<br>
 <tt class="backtick">randomise&nbsp;-i&nbsp;TwoSamp4D&nbsp;-o&nbsp;TwoSampT&nbsp;-d&nbsp;design.mat&nbsp;-t&nbsp;design.con&nbsp;-m&nbsp;mask&nbsp;-T</tt> <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line867">
<h2 id="Two-Sample_Paired_T-test_.28Paired_Two-Group_Difference.29">Two-Sample Paired T-test (Paired Two-Group Difference)</h2>
<span class="anchor" id="line-71"></span><p class="line862">We will follow the setup in the <a href="./FEAT(2f)UserGuide.html#Paired_Two-Group_Difference_.28Two-Sample_Paired_T-Test.29">FEAT manual</a> where we have a group of 8 subjects scanned under two different conditions, A and B. Condition A will be entered as the first 8 inputs, and condition B as the second 8 inputs, with the subjects in the same order in each case (ordering is, naturally, very important). <span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line862">The design matrix (<tt class="backtick">design.mat</tt>) looks like <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line867"><tt class="backtick">&nbsp;1&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0</tt><br>
<tt class="backtick">&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1</tt><br>
<tt class="backtick">-1&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0&nbsp;0&nbsp;</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;0</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1&nbsp;0&nbsp;</tt><br>
<tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;1</tt><br>
 <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><p class="line874">where the first column models the group difference, and the individual subject means are modelled by columns 2 to 9. <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line862">The t-contrast (<tt class="backtick">design.con</tt>) for the group difference, A-B, is simply<br>
 <tt class="backtick">1&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
 and for B-A, just replace <tt class="backtick">1</tt> with <tt class="backtick">-1</tt> in this contrast. <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><p class="line862">The exchangeability-block information (<tt class="backtick">design.grp</tt>) can be entered via the "Group" column in the GLM Gui (see the <a href="./Randomise(2f)UserGuide(2f)GLM_pairedT_example.html">example GLM setup</a> here or, alternatively, it can be created independently as a simple text file).  The values in this need to specify which data can be exchanged, that is, only condition A and B within the same subject (since the null hypothesis is that there is no difference between A and B, but each subject could have a different mean value and so we cannot exchange between subjects). Therefore there are eight different blocks and the file looks like <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><p class="line867"><tt class="backtick">1</tt><br>
<tt class="backtick">2</tt><br>
<tt class="backtick">3</tt><br>
<tt class="backtick">4</tt><br>
<tt class="backtick">5</tt><br>
<tt class="backtick">6</tt><br>
<tt class="backtick">7</tt><br>
<tt class="backtick">8</tt><br>
<tt class="backtick">1</tt><br>
<tt class="backtick">2</tt><br>
<tt class="backtick">3</tt><br>
<tt class="backtick">4</tt><br>
<tt class="backtick">5</tt><br>
<tt class="backtick">6</tt><br>
<tt class="backtick">7</tt><br>
<tt class="backtick">8</tt><br>
 <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line862">Once you have set up these design files you can run:<br>
 <tt class="backtick">randomise&nbsp;-i&nbsp;PairedT4D&nbsp;-o&nbsp;PairedT&nbsp;-d&nbsp;design.mat&nbsp;-t&nbsp;design.con&nbsp;-e&nbsp;design.grp&nbsp;-m&nbsp;mask&nbsp;-T&nbsp;</tt> <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line874">Note that a completely alternative way to do a paired analysis is to calculate the difference values within-subject initially (e.g., using fslmaths) and then do a simple one-group t-test (across subjects) on these within-subject differences. <span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line867">
<h2 id="Repeated_measures_ANOVA">Repeated measures ANOVA</h2>
<span class="anchor" id="line-90"></span><p class="line874">Following the ANOVA: 1-factor 4-levels (Repeated Measures) example from the FEAT manual, assume we have 2 subjects with 1 factor at 4 levels. We therefore have eight input images and we want to test if there is any difference over the 4 levels of the factor. The design matrix looks like <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line867"><tt class="backtick">1&nbsp;0&nbsp;1&nbsp;0&nbsp;0</tt><br>
 <tt class="backtick">1&nbsp;0&nbsp;0&nbsp;1&nbsp;0</tt><br>
 <tt class="backtick">1&nbsp;0&nbsp;0&nbsp;0&nbsp;1</tt><br>
 <tt class="backtick">1&nbsp;0&nbsp;0&nbsp;0&nbsp;0</tt><br>
 <tt class="backtick">0&nbsp;1&nbsp;1&nbsp;0&nbsp;0</tt><br>
 <tt class="backtick">0&nbsp;1&nbsp;0&nbsp;1&nbsp;0</tt><br>
 <tt class="backtick">0&nbsp;1&nbsp;0&nbsp;0&nbsp;1</tt><br>
 <tt class="backtick">0&nbsp;1&nbsp;0&nbsp;0&nbsp;0</tt><br>
 <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line874">where the first two columns model subject means and the 3rd through 5th column model the categorical effect (Note the different arrangement of rows relative to the FEAT example). Three t-contrasts for the categorical effect <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line867"><tt class="backtick">0&nbsp;0&nbsp;1&nbsp;0&nbsp;0</tt><br>
 <tt class="backtick">0&nbsp;0&nbsp;0&nbsp;1&nbsp;0</tt><br>
 <tt class="backtick">0&nbsp;0&nbsp;0&nbsp;0&nbsp;1</tt><br>
 <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line874">are selected together into a single F-contrast <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line867"><tt class="backtick">1&nbsp;1&nbsp;1</tt><br>
 <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line874">Modify the exchangeability-block information in design.grp to match <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><p class="line867"><tt class="backtick">1</tt><br>
 <tt class="backtick">1</tt><br>
 <tt class="backtick">1</tt><br>
 <tt class="backtick">1</tt><br>
 <tt class="backtick">2</tt><br>
 <tt class="backtick">2</tt><br>
 <tt class="backtick">2</tt><br>
 <tt class="backtick">2</tt><br>
 <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><p class="line862">This will ensure that permutations will only occur within subject, respecting the repeated measures structure of the data. The number of permutations can be computed for each group, and then multiplied together to find the total number of permutations. We use the ANOVA computation for 4 levels, and hence (1+1+1+1)!/1!/1!/1!/1! = 24 possible permutations for one subject, and hence 24 × 24 = 576 total permutations. The call is then similar to the above examples:<br>
 <tt class="backtick">randomise&nbsp;-i&nbsp;TwoSamp4D&nbsp;-o&nbsp;TwoSampT&nbsp;-d&nbsp;design.mat&nbsp;-t&nbsp;design.con&nbsp;-f&nbsp;design.fts&nbsp;-m&nbsp;mask&nbsp;-e&nbsp;design.grp&nbsp;-T</tt> <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><p class="line867">
<h2 id="Getting_Cluster_and_Peak_Information_from_Randomise_Output">Getting Cluster and Peak Information from Randomise Output</h2>
<span class="anchor" id="line-109"></span><p class="line874">Assuming that the best image to get the clusters and peak information from is the raw tstat image: <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><p class="line874">begin by masking this with the significant voxels from corrp: <span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line867"><tt class="backtick">fslmaths&nbsp;grot_tfce_corrp_tstat1&nbsp;-thr&nbsp;0.95&nbsp;-bin&nbsp;-mul&nbsp;grot_tstat1&nbsp;grot_thresh_tstat1</tt> <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line874">Now run cluster to extract the clusters and local maxima in several different outputs: <span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line867"><tt class="backtick">cluster&nbsp;--in=grot_thresh_tstat1&nbsp;--thresh=0.0001&nbsp;--oindex=grot_cluster_index&nbsp;--olmax=grot_lmax.txt&nbsp;--osize=grot_cluster_size</tt> <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line874">If the data is already in standard space (MNI152) and co-ordinate reporting is wanted in MNI (mm) values, add --mm to the end of the command. <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line874">If clusters need to be forced to be more highly split, the --thresh value can be raised to an appropriate level. Because the input image was already masked by the corrp image, regardless of the thresh value used in the cluster command, only significant voxels will ever be reported. <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line867">
<h1 id="Two-pass_mode">Two-pass mode</h1>
<span class="anchor" id="line-126"></span><p class="line874">Currently this mode operates on cluster ( -c ) and TFCE statistics only. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><p class="line867"><hr /><p class="line874">  <span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867">
<h1 id="Associated_Tools">Associated Tools</h1>
<span class="anchor" id="line-131"></span><p class="line867">
<h2 id="Lesion_Masking">Lesion Masking</h2>
<span class="anchor" id="line-132"></span><p class="line862">For many clinical studies there are pathologies present (we are calling them "lesions" here, but they could be anything) and it is desirable to exclude them from the analysis, since they are usually highly variable across patients.  In order to make this task easier in randomise there is a script called <tt class="backtick">setup_masks</tt>.  This takes a set of user-defined masks (normally drawn by hand) and creates a suitable set of files that can be used in randomise, including modified design matrices and contrasts to include the mask-based EVs.  The masks should be in the form that can be used directly in randomise; that is, in the same space and containing a value of 1 in the voxels to be excluded and 0 in all other voxels (so that a lesion would be filled with ones in this case). <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line874">Usage of the script is: <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line867"><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><pre><span class="anchor" id="line-1"></span>setup_masks &lt;input matrix&gt; &lt;input contrast&gt; &lt;output basename&gt; &lt;mask1&gt; &lt;mask2&gt; ...
<span class="anchor" id="line-2"></span>
<span class="anchor" id="line-3"></span>The list of mask images (&lt;mask1&gt; &lt;mask2&gt; ...) must be from subjects in the same order as used in the design matrix</pre><span class="anchor" id="line-141"></span><p class="line874">New versions of both the design matrix and contrasts are created (starting with the specified output basename).  In addition, a set of images is created, suitable as voxelwise regressors for randomise, and a list file tailored for randomise. <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line874">The final output of the script is an example call to randomise (printed to the screen) that shows exactly how to use the output files in a call to randomise.  Other options (as would have been used without the voxelwise regressors) can then be added at the end of the randomise command to easily form a complete randomise call. <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-146"></span><a href="./CategoryRandomise.html">CategoryRandomise</a> <span class="anchor" id="line-147"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2014-07-08 15:34
</body>
</html>
