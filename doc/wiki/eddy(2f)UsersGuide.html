<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>eddy/UsersGuide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">eddy/UsersGuide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./eddy.html">Introduction</a></li><li>Users Guide<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Running_eddy">Running eddy</a><ol><li>
<a href="#The_data">The data</a></li><li>
<a href="#Running_topup_on_the_b.3D0_volumes">Running topup on the b=0 volumes</a></li><li>
<a href="#Running_.60eddy.60">Running `eddy`</a></li></ol></li><li>
<a href="#List_of_parameters">List of parameters</a></li><li>
<a href="#Parameters_explained">Parameters explained</a><ol><li>
<a href="#A--imain">--imain</a></li><li>
<a href="#A--mask">--mask</a></li><li>
<a href="#A--acqp">--acqp</a></li><li>
<a href="#A--index">--index</a></li><li>
<a href="#A--bvecs">--bvecs</a></li><li>
<a href="#A--bvals">--bvals</a></li><li>
<a href="#A--out">--out</a></li><li>
<a href="#A--topup">--topup</a></li><li>
<a href="#A--flm">--flm</a></li><li>
<a href="#A--fwhm">--fwhm</a></li><li>
<a href="#A--niter">--niter</a></li><li>
<a href="#A--verbose">--verbose</a></li><li>
<a href="#A--help">--help</a></li></ol></li></ol></div></div></li><li><a href="./eddy(2f)Faq.html">FAQ</a></li></ol></div> <span class="anchor" id="line-5"></span>
<h1 id="Running_eddy">Running eddy</h1>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line862">Running <tt class="backtick">eddy</tt> is a little bit more complicated than running for example its predecessor <tt class="backtick">eddy_correct</tt>. The reasons for this are <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><ul><li><p class="line891"><tt class="backtick">eddy</tt> attempts to combine the correction for susceptibility and eddy currents/movements so that there is only one single resampling. This means we need to "inform" <tt class="backtick">eddy</tt> of the results from <a href="./topup.html">topup</a> (which is used to calculate the susceptibility distortions). <span class="anchor" id="line-10"></span></li><li><p class="line862">Unlike <tt class="backtick">eddy_correct</tt>, <tt class="backtick">eddy</tt> attempts to model the diffusion signal. This means that <tt class="backtick">eddy</tt> needs to be informed of the diffusion direction/weighting that was used for each volume. <span class="anchor" id="line-11"></span></li><li><p class="line891"><tt class="backtick">eddy</tt> can utilise the information from different acquisitions that modulate how off-resonance translates into distortions. An example of this would be acquisitions with different polarity of the phase-encoding. Hence we need to inform <tt class="backtick">eddy</tt> about how each volume was acquired. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span></li></ul><p class="line862">The need to pass more information to <tt class="backtick">eddy</tt> results in a more complicated command line. Here I will outline a typical use of <a href="./topup.html">topup</a> and <tt class="backtick">eddy</tt> (they are really intended to be used together) on a "typical" data set suited for use with <tt class="backtick">eddy</tt>. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867">
<h2 id="The_data">The data</h2>
<span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line862">The data for this example consists of one set of volumes acquired with phase-encoding A&gt;&gt;P consisting of 5 b=0 volumes and 59 diffusion weighted volumes  <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><div><table><tbody><tr>  <td style="text-align: center;"><p class="line891"><tt class="backtick">data.nii.gz</tt></td>
</tr>
<tr>  <td><span class="anchor" id="line-20"></span><p class="line891"><img align="top" alt="A2P_five_volumes.jpeg" class="attachment" src="attachments/eddy(2f)UsersGuide/A2P_five_volumes.jpeg" title="A2P_five_volumes.jpeg" width="800" /></td>
</tr>
<tr>  <td style="text-align: center;"><span class="anchor" id="line-21"></span><p class="line862">First b=0 volume and the first four dwis of the A&gt;&gt;P data</td>
</tr>
</tbody></table></div><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line862">and one single b=0 volume with phase-encoding P&gt;&gt;A. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><div><table><tbody><tr>  <td style="text-align: center;"><p class="line891"><tt class="backtick">P2A_b0.nii.gz</tt></td>
</tr>
<tr>  <td><span class="anchor" id="line-26"></span><p class="line891"><img align="top" alt="P2A_b0.jpeg" class="attachment" src="attachments/eddy(2f)UsersGuide/P2A_b0.jpeg" title="P2A_b0.jpeg" width="160" /></td>
</tr>
<tr>  <td style="text-align: center;"><span class="anchor" id="line-27"></span><p class="line862">The P&gt;&gt;A data</td>
</tr>
</tbody></table></div><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line862">Note how the shape of the b=0 scan is different for the two different acquisitions. This is what <a href="./topup.html">topup</a> will use in order to calculate the susceptibility induced off-resonance field. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867">
<h2 id="Running_topup_on_the_b.3D0_volumes">Running topup on the b=0 volumes</h2>
<span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><p class="line862">The first thing we do is to run <a href="./topup.html">topup</a> to estimate the susceptibility induced off-resonance field. In order to prepare the data for <a href="./topup.html">topup</a> we issue the following commands <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867"><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><pre><span class="anchor" id="line-1"></span>fslroi data A2P_b0 0 1
<span class="anchor" id="line-2"></span>fslmerge -t A2P_P2A_b0 A2P_b0 P2A_b0
<span class="anchor" id="line-3"></span>printf "0 -1 0 0.0646\n0 1 0 0.646" &gt; acqparams.txt </pre><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line862">The first two commands will produce a file called <tt class="backtick">A2P_P2A_b0.nii.gz</tt> containing the two b=0 volume, and the third command will create a file (named <tt class="backtick">acqparams.txt</tt>) that informs <a href="./topup.html">topup</a>/<tt class="backtick">eddy</tt> of how the data was collected. This file is described <a class="nonexistent" href="./topup(2f)TopupUsersGuide(2f).html#A--datain">here</a>, <a href="./eddy(2f)UsersGuide.html#A--acqp">here</a> and in more detail <a href="./eddy(2f)Faq.html#How_do_I_know_what_to_put_into_my_--acqp_file">here</a>. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line862">Now it is time to run <a href="./topup.html">topup</a> which we do with the command <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line867"><tt class="backtick">topup&nbsp;--imain=A2P_P2A_b0&nbsp;--datain=acqparams.txt&nbsp;--config=b02b0.cnf&nbsp;--out=my_topup_results&nbsp;--iout=my_hifi_b0</tt> <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">which will give us as our main result a file named <tt class="backtick">my_topup_results_fieldcoef.nii.gz</tt> which contains an estimate of the susceptibility induced off-resonance field. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line867">
<h2 id="Running_.60eddy.60">Running `eddy`</h2>
<span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><p class="line862">Before we can run <tt class="backtick">eddy</tt> we need to do a couple of more preparations. First of all we need a mask that separate brain from non-brain. This is no different from for example the mask that <a href="./FDT(2f)UserGuide.html#DTIFIT">`dtifit`</a> needs. Since <tt class="backtick">eddy</tt> will work in a non-distorted space we will base the mask on <tt class="backtick">my_hifi_b0.nii.gz</tt> (the secondary output from our <a href="./topup.html">topup</a> command above). We generate this mask with the commands <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><p class="line867"><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><pre><span class="anchor" id="line-1-1"></span>fslmaths my_hifi_b0 -Tmean my_hifi_b0
<span class="anchor" id="line-2-1"></span>bet my_hifi_b0 my_hifi_b0_brain -m</pre><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line862">which results in the file <tt class="backtick">my_hifi_b0_brain_mask.nii.gz</tt>. It may be a good idea to check this stage to ensure <tt class="backtick">bet</tt> has done a good job of extracting the brain.  <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line862">The final thing we need to do is to create an index file that tells <tt class="backtick">eddy</tt> which line/of the lines in the <tt class="backtick">acqparams.txt</tt> file that are relevant for the data passed into <tt class="backtick">eddy</tt>. In this case all the volumes in <tt class="backtick">data.nii.gz</tt> are acquired A&gt;&gt;P which means that the first line of <tt class="backtick">acqparams.txt</tt> describes the acquisition for all the volume. We specify that by passing a text file with as many ones as there are volumes in <tt class="backtick">data.nii.gz</tt>. One way of creating such a file would be to type the following commands <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line867"><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><pre><span class="anchor" id="line-1-2"></span>indx=""
<span class="anchor" id="line-2-2"></span>for ((i=1; i&lt;=64; i+=1)); do indx="$indx 1"; done
<span class="anchor" id="line-3-1"></span>echo $indx &gt; index.txt</pre><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><p class="line862">where 64 is the total number of volumes in <tt class="backtick">data.nii.gz</tt> and needs to be replaced by the number of volumes in your data. <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line862">We are now in a position to run <tt class="backtick">eddy</tt> using the command <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line867"><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><pre><span class="anchor" id="line-1-3"></span>eddy --imain=data --mask=my_hifi_b0_brain_mask --acqp=acqparams.txt --index=index.txt --bvecs=bvecs --bvals=bvals --topup=my_topup_results --out=eddy_corrected_data</pre><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line862">You may be in for quite a long wait as <tt class="backtick">eddy</tt> is quite CPU intensive and also memory hungry. It has been written using OpenMP to take advantage of multiple processors and this may/may not be available to you depending on how it was built in your system. A rule of thumb for how much memory <tt class="backtick">eddy</tt> will use is 8*m*n<sub>x</sub>n<sub>y</sub>n<sub>z</sub> bytes where m is the number of volumes in <tt class="backtick">--imain</tt>, n<sub>x</sub> is the matrix-size in the x-direction, n<sub>y</sub> is the matrix size in the y-direction and n<sub>z</sub> is the number of slices. <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><p class="line867">
<h1 id="List_of_parameters">List of parameters</h1>
<span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><ul><li>Parameters that specify input files <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><ul><li style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--imain">--imain=filename</a> <br>
 Name of a file with input images. E.g. <tt class="backtick">all_my_images.nii</tt>. Compulsory. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--mask">--mask=filename</a> <br>
 Name of a file with mask specifying brain vs no-brain. E.g. <tt class="backtick">my_brain_mask.nii</tt>.  Compulsory. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--acqp">--acqp=filename</a> <br>
 Name of text file with information about the acquisition of the images in <tt class="backtick">--imain</tt>. E.g. <tt class="backtick">my_scan_pars.txt</tt>.  Compulsory. <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--index">--index=filename</a> <br>
 Name of text file specifying the relationship between the images in --imain and the information in --acqp and --topup. E.g. <tt class="backtick">index.txt</tt>.  Compulsory. <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--bvecs">--bvecs=filename</a> <br>
 Name of text-file with <a href="./FDT(2f)UserGuide.html#DTIFIT">normalised diffusion gradients</a>. Compulsory. <span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--bvals">--bvals=filename</a> <br>
 Name of text-file with <a href="./FDT(2f)UserGuide.html#DTIFIT">b-values</a>. Compulsory. <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--topup">--topup=filename</a> <br>
 Name of output from a previous <a href="./topup.html">topup</a> run. Should be the same as the argument given to <tt class="backtick">topup</tt>'s <a class="nonexistent" href="./topup(2f)TopupUsersGuide(2f).html#A--out">--out</a>. Optional. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span></li></ul></li><li class="gap">Parameters specifying names of output-files <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><ul><li style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--out">--out=basename</a> <br>
 Basename for output-files. The corrected images will be named <tt class="backtick">"basename".nii.gz</tt>. Compulsory. <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span></li></ul></li><li class="gap"><p class="line862">Parameters specifying how <tt class="backtick">eddy</tt> should be run <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><ul><li style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--flm">--flm=linear/quadratic/cubic</a> <br>
 Spatial model for the field generated by eddy currents. Default <tt class="backtick">quadratic</tt>. <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--fwhm">--fwhm="fwhm in mm"</a> <br>
 Filter width to use for pre-filtering of data for the estimation process. Default 0. <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><a href="./eddy(2f)UsersGuide.html#A--niter">--niter="required number of iterations"</a> <br>
 Specifies how many iterations should be run. Default 5. <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><tt class="backtick">--verbose</tt> <br>
 Print progress information to the screen while running. Can be useful to pipe into file before reporting problems <span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span></li><li class="gap" style="list-style-type:none"><p class="line891"><tt class="backtick">--help</tt> <br>
 Take a wild stab. <span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span></li></ul></li></ul><p class="line867">
<h1 id="Parameters_explained">Parameters explained</h1>
<span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line867">
<h2 id="A--imain">--imain</h2>
<span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">Should specify a 4D image file with <em>all</em> your images acquired as part of a diffusion protocol. I.e. it should contain both your dwis and your <em>b</em>=0 images. If you have collected your data with reversed phase-encode blips, data for both blip-directions should be in this file. <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867">
<h2 id="A--mask">--mask</h2>
<span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><p class="line862">Single volume image file with ones and zeros specifying brain (one) and no-brain (zero). Typically obtained by running <a href="./BET(2f)UserGuide.html">BET</a> on the first <em>b</em>=0 image. If you have previously run <a href="./topup.html">topup</a> on your data I suggest you run <a href="./BET(2f)UserGuide.html">BET</a> on the first volume (or the average of all volumes) of the <a href="./topup(2f)TopupUsersGuide.html#A--iout">--iout</a> output and use that. <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line867">
<h2 id="A--acqp">--acqp</h2>
<span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line862">A text-file describing the acquisition parameters for the different images in <a href="./eddy(2f)UsersGuide.html#A--imain">--imain</a>. The format of this file is identical to that used by <a class="nonexistent" href="./topup(2f)TopupUsersGuide(2f).html#A--datain">topup</a> (though the parameter is called <tt class="backtick">--datain</tt> there) and described in detail <a href="./eddy(2f)Faq.html#How_do_I_know_what_to_put_into_my_--acqp_file">here</a>. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line867">
<h2 id="A--index">--index</h2>
<span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line862">A text-file that determines the relationship between on the one hand the images in <a href="./eddy(2f)UsersGuide.html#A--imain">--imain</a> and on the other hand the acquisition parameters in <a href="./eddy(2f)UsersGuide.html#A--acqp">--acqp</a> and (optionally) the subject movement information in <a href="./eddy(2f)UsersGuide.html#A--topup">--topup</a>. It should be a single column (or row) with one entry per volume in <a href="./eddy(2f)UsersGuide.html#A--imain">--imain</a>. We will use a small (simplified) example to make it clear. <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line867"><img align="top" alt="eight_original_images.png" class="attachment" src="attachments/eddy(2f)UsersGuide/eight_original_images.png" title="eight_original_images.png" width="800" /> <span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line862">The image above shows a selected slice from each of the eight volumes in <a href="./eddy(2f)UsersGuide.html#A--imain">--imain</a>. The associated <a href="./eddy(2f)UsersGuide.html#A--acqp">--acqp</a> file is <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line867"><tt class="backtick">-1&nbsp;0&nbsp;0&nbsp;0.051</tt><br>
<tt class="backtick">1&nbsp;0&nbsp;0&nbsp;0.051</tt> <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><p class="line862">which specifies that phase-encoding is performed in the <em>x</em>-direction, sometimes traversing <em>k</em>-space left-&gt;right (-1) and sometimes right-&gt;left (1). Finally the <tt class="backtick">--index</tt> file is <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line867"><tt class="backtick">1&nbsp;1&nbsp;1&nbsp;1&nbsp;2&nbsp;2&nbsp;2&nbsp;2</tt> <span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line862">which specifies that the first four volumes in <a href="./eddy(2f)UsersGuide.html#A--imain">--imain</a> were acquired using the acquisition parameters on the first row (index 1) of the <a href="./eddy(2f)UsersGuide.html#A--acqp">--acqp</a> file, and that volumes 5--8 were acquired according to the second row (index 2). <span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><p class="line862">There are cases when there may be advantageous to have more than two lines in the <a href="./eddy(2f)UsersGuide.html#A--acqp">--acqp</a> file and in these cases there will be more than two different index values in the <tt class="backtick">--index</tt> file. These cases are explained <a href="./eddy(2f)Faq.html#Why_do_I_need_more_than_two_rows_in_my_--acqp_file">here</a> <span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line867">
<h2 id="A--bvecs">--bvecs</h2>
<span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line862">A text file with normalised vectors describing the direction of the diffusion weighting. This is the same file that you would use for <a href="./FDT(2f)UserGuide.html#DTIFIT">FDT</a>. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line867">
<h2 id="A--bvals">--bvals</h2>
<span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line862">A text file with <em>b</em>-values () describing the "amount of" diffusion weighting. This is the same file that you would use for <a href="./FDT(2f)UserGuide.html#DTIFIT">FDT</a>. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line867">
<h2 id="A--out">--out</h2>
<span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line862">Specifies the basename of the output. Let us say <tt class="backtick">--out="basename"</tt>. The output will then consist of a 4D image file named <tt class="backtick">&lt;basename&gt;.nii.gz</tt> containing all the corrected volumes and a text-file named <tt class="backtick">&lt;basename&gt;.eddy_parameters</tt> with parameters defining the field and movement for each scan. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867">
<h2 id="A--topup">--topup</h2>
<span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><p class="line862">This should only be specified if you have previously run <a href="./topup.html">topup</a> on your data and should be the same name that you gave as an argument to the <a href="./topup(2f)TopupUsersGuide.html#A--out">--out</a> parameter when you ran <tt class="backtick">topup</tt>. <span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><p class="line867">
<h2 id="A--flm">--flm</h2>
<span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line862">This parameter takes the values <tt class="backtick">linear</tt>, <tt class="backtick">quadratic</tt> or <tt class="backtick">cubic</tt>. It specifies how "complicated" we believe the eddy current-induced fields may be.  <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><p class="line862">Setting it to <tt class="backtick">linear</tt> implies that we think that the field caused be eddy currents will be some combination of linear gradients in the x-, y- and z-directions. It is this model that is the basis for the claim "eddy current distortions is a combination of shears, a zoom and a translation". It is interesting (and surprising) how successful this model has been in describing (and correcting) eddy current distortions since not even the fields we intend to be linear (<em>i.e.</em> our gradients) are particularly linear on modern scanners. <span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><p class="line862">The next model in order of "complication" is <tt class="backtick">quadratic</tt> which assumes that the eddy current induced field can be modelled as some combination of linear and quadratic terms (x<sup>2</sup>, y<sup>2</sup>, z<sup>2</sup>, xy, xz and yz). This is almost certainly also a vast oversimplification but our practical experience has been that this model successfully corrects for example the HCP data (which is not well corrected by the <tt class="backtick">linear</tt> model). <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line862">The final model is <tt class="backtick">cubic</tt> which in addition to the terms in the <tt class="backtick">quadratic</tt> model also has cubic terms (x<sup>3</sup>, x<sup>2</sup>y, etc). We have yet to find a data set where the <tt class="backtick">cubic</tt> model performs significantly better than the <tt class="backtick">quadratic</tt> one. Note also that the more complicated the model the longer will <tt class="backtick">eddy</tt> take to run. <span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line867">
<h2 id="A--fwhm">--fwhm</h2>
<span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><p class="line862">Specifies the FWHM of a gaussian filter that is used to pre-condition the data before using it to estimate the distortions. I have found a little smoothing to be helpful in every registration algorithm I have ever worked with, <em>except</em> <tt class="backtick">eddy</tt> where it seems that <tt class="backtick">--fwhm=0</tt> is the best. This is also the default. <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><p class="line867">
<h2 id="A--niter">--niter</h2>
<span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line867"><tt class="backtick">eddy</tt> does not check for convergence. Instead it runs a fixed number of iterations given by <tt class="backtick">--niter</tt>. This is quite typical for registration algorithms where each iteration is often expensive (i.e. takes long time). Instead we run it for a fixed number of iterations, 5 as default. <span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line867">
<h2 id="A--verbose">--verbose</h2>
<span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line874">Turns on printing of information about the algorithms progress to the screen. <span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><p class="line867">
<h2 id="A--help">--help</h2>
<span class="anchor" id="line-184"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2014-07-08 15:34
</body>
</html>
