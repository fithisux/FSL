<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>BASIL/UserGuide</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="fsl/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="fsl/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="fsl/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">BASIL/UserGuide</a>
</ul>
<br><br>
[<a href="FSL.html">FSL</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="FslToolContents">
<h1>Contents</h1>
<ol><li><a href="./BASIL.html">Introduction</a></li><li>User Guide<div class="contentslist"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Kinetic_analysis_concepts">Kinetic analysis concepts</a><ol><li>
<a href="#Definition_of_inversion_time">Definition of inversion time</a></li><li>
<a href="#Bolus_duration">Bolus duration</a></li><li>
<a href="#Macro_vascular_.28arterial.29_contribution">Macro vascular (arterial) contribution</a></li><li>
<a href="#T1_values">T1 values</a></li><li>
<a href="#Registration">Registration</a></li><li>
<a href="#Performing_fast_analysis">Performing fast analysis</a></li><li>
<a href="#Spatial_regularization">Spatial regularization</a></li><li>
<a href="#Partial_volume_correction">Partial volume correction</a></li></ol></li><li>
<a href="#Single_delay_data">Single delay data</a></li><li>
<a href="#Asl_gui">Asl_gui</a><ol><li>
<a href="#Data">Data</a></li><li>
<a href="#Analysis">Analysis</a></li><li>
<a href="#Registration-1">Registration</a></li><li>
<a href="#Calibration">Calibration</a></li><li>
<a href="#Output">Output</a></li></ol></li><li>
<a href="#Oxford_ASL">Oxford_ASL</a><ol><li>
<a href="#Changes_from_FSL_5.0.6_onward">Changes from FSL 5.0.6 onward</a></li><li>
<a href="#Output-1">Output</a></li><li>
<a href="#Usage">Usage</a><ol><li>
<a href="#acquisition_specific">acquisition specific</a></li><li>
<a href="#Calibration-1">Calibration</a></li><li>
<a href="#Registration-2">Registration</a></li><li>
<a href="#Analysis-1">Analysis</a></li></ol></li></ol></li><li>
<a href="#BASIL">BASIL</a><ol><li>
<a href="#Multi-step_inference">Multi-step inference</a></li><li>
<a href="#Calling_BASIL">Calling BASIL</a><ol><li>
<a href="#A.60-.40.60_The_parameter_file">`-@` The parameter file</a><ol><li>
<a href="#Resting-state_ASL_model">Resting-state ASL model</a></li><li>
<a href="#Data-1">Data</a></li></ol></li></ol></li><li>
<a href="#Results">Results</a></li><li>
<a href="#Noise_Model_.28Advanced_option.29">Noise Model (Advanced option)</a></li></ol></li><li>
<a href="#QUASIL">QUASIL</a><ol><li>
<a href="#Usage-1">Usage</a><ol><li>
<a href="#Extended_options">Extended options</a></li></ol></li><li>
<a href="#Calibration-2">Calibration</a></li></ol></li><li>
<a href="#Calibration_.28asl_calib.29">Calibration (asl_calib)</a><ol><li>
<a href="#asl_calib_usage">asl_calib usage</a><ol><li>
<a href="#Output_options">Output options</a></li><li>
<a href="#Extended_Options">Extended Options</a></li><li>
<a href="#Mode_specific_options">Mode specific options</a><ol><li>
<a href="#LongTR">LongTR</a></li><li>
<a href="#SatRecov">SatRecov</a></li></ol></li></ol></li><li>
<a href="#A.27Tissue.27_reference_type">'Tissue' reference type</a></li><li>
<a href="#Automatic_reference_.27tissue.27_mask">Automatic reference 'tissue' mask</a></li><li>
<a href="#Using_M0_and_sensitivity_images_to_calculate_absolute_CBF">Using M0 and sensitivity images to calculate absolute CBF</a></li></ol></li><li>
<a href="#Data_assembly_.26_tag-control_subtraction_.28asl_file.29">Data assembly &amp; tag-control subtraction (asl_file)</a></li></ol></div></div></li><li><a href="./BASIL(2f)Tutorial.html">Tutorial</a></li><li><a href="./BASIL(2f)FurtherInformation.html">Further Information</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Kinetic_analysis_concepts">Kinetic analysis concepts</h1>
<span class="anchor" id="line-6"></span><p class="line874">BASIL permits various options to be applied when performing the kinetic model-based analysis, here some conceptual details of these options are given. Note that the way you choose these options varies between the different tools (see the individual guides for more information). <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867">
<h2 id="Definition_of_inversion_time">Definition of inversion time</h2>
<span class="anchor" id="line-9"></span><p class="line874">Inversion time (commonly quoted for pASL) is defined as the time from the start of labelling to time of image acquisition. Often for cASL or pcASL the 'post labelling delay' is quoted and is the time from the end of the labelling until image acquisition. Thus: <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">cASL or pcASL: TI = PLD + Labelling duration <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line874">This distinction does not arise in pASL, since the labelling is instantaneous. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line867">
<h2 id="Bolus_duration">Bolus duration</h2>
<span class="anchor" id="line-16"></span><p class="line862">Although some ASL sequences fix the temporal duration of the bolus, e.g. QUIPSS2, due to dispersion it is still feasible that the actual bolus length may vary across the brain. BASIL can take this into account by inferring the bolus length directly from the data and <tt class="backtick">Oxford_asl</tt> does this by default. Even if you infer the bolus duration you should set a guess for the bolus duration as determined by you sequence. NOTE if your sequence results in an effectively infinite bolus length, e.g. FAIR, then there still might be a justification for inferring a finite bolus length depending upon the extent of the coil used for tagging. In which case you should set the bolus duration to some reasonable value (less than the last TI). <span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line874">For a cASL or pcASL acquisition the bolus duration will be set by the duration for which labeling was applied. Thus it is reasonable to fix the 'bolus duration' parameter to that value. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line867">
<h2 id="Macro_vascular_.28arterial.29_contribution">Macro vascular (arterial) contribution</h2>
<span class="anchor" id="line-21"></span><p class="line862">If flow crushing has not been used then there may be significant signal from labeled arterial blood in the region of major vessels in the ASL data, for more information see Chappell et al., <em>MRM, 2010</em>. This is usually only an issue in short inversion time or post label delay images. For single delay ASL the issue is often avoided by chosing a suitably long delay such that label will have already passed into the capillary bed.For multi delay data the macro vaslcuar signal can be accounted for by modelling this arterial component (by default oxford_asl includes this component). When the macro vascular component is included in the analysis then a further parameter, the arterial blood volume, is available from the analysis. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line867">
<h2 id="T1_values">T1 values</h2>
<span class="anchor" id="line-24"></span><p class="line874">T1 values are important to the kinetic model inversion and should be chosen based on the field strength that data was acquired at, consideration might also need to be taken of the subject in which analysis is being carried out. BASIL by deafult takes values for 3T and assumes for the tissue only a grey matter value, unless partial volume correction is applied when separate grey and white matter values are specified. <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line874">Commonly it is assumed that T1 and T1b take a fixed value in the kinetic curve model. However, this value is not absolutely certain and may well vary across the brain. BASIL can take this into account by inferring on T1 and T1b, you should still, however, set sensible expected T1 and T1b values. NOTE: maps of T1 and T1b produced by this process are unlikely to be accurate measures of T1 in the brain - ASL data is not suitable for this. The purpose of including T1 and T1b in the inference is primarily to take account of their varaibility when estimating the other parameters. An exception to this is QUASAR data (in quasil) where a T1 image is estimated from the saturation recovery of the control data (and subsequently applied to the kinetic curve fitting). <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line867">
<h2 id="Registration">Registration</h2>
<span class="anchor" id="line-29"></span><p class="line862">Registration of ASL data to the structural image is difficult since the images are low resolution and with limited contrast. By default in <tt class="backtick">oxford_asl</tt> registration is carried out in multiple steps using the supplied ASL difference data, this is often sub optimal. A better result can be obtained by using the perfusion image directly to perform registration after the BASIL analysis. However, a far better option is generally to use the raw (undifferenced) ASL data as a basis for registration and the <tt class="backtick">--regfrom</tt> option in <tt class="backtick">oxford_asl</tt> exists for this purpose. The GUI will automatically try to use the raw data as the basis for registration for this reason.  <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867">
<h2 id="Performing_fast_analysis">Performing fast analysis</h2>
<span class="anchor" id="line-32"></span><p class="line874">By default BASIL does analysis in multiple steps adding new parameters a few at a time in separate analysis steps. It is possible to perform the analysis in a single step if you are using the basil command line tool, producing results more quickly. The result is likely to be less robust than the multi-step analysis when there are a large number of parameters in the model, i.e. if you are using all the inference options. It is, however, normally pretty stable in combination with spatial priors for most analysis problems. Thus you might want to use this to check the data, but use multiple steps for the very final result. <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867">
<h2 id="Spatial_regularization">Spatial regularization</h2>
<span class="anchor" id="line-35"></span><p class="line862">BASIL can apply a spatial smoothing prior to the estimated CBF image, for more information see Groves 'et al', <a class="nonexistent" href="./NeuroImage.html">NeuroImage</a>, 2009. This exploits the fact that neighboring voxels are likely to have similar CBF values, i.e. CBF variation in the brain is relatively smooth. It brings the advantages associated with the more common pre-processing step of spatially smoothing the data. However, unlike smoothing the data it correctly preserves the non-linear kinetics exploited by the CBF estimation. It is also adaptive, so that in regions where the data does not support the use of smoothing the CBF image will not be smoothed. The spatial priors can be combined with the fast analysis option to achieve rapid results with a good level of robustness to noise. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line867">
<h2 id="Partial_volume_correction">Partial volume correction</h2>
<span class="anchor" id="line-38"></span><p class="line862">The low resolution of ASL data typically means that there is substantial partial voluming of grey (GM) and white matter (WM), plus CSF too. Since GM and WM have very different kinetics (WM tends to have lower CBF and longer arrival times) a normal analysis will provide a CBF that is something of a combination of the two tissue types. BASIL can attempt to automatically correct for the different tissue types, for more details see Chappell <em>et al.</em>, MRM, 2011. Currently oxford_asl can try to do this automatically as long as you supply a structural image, but this implementation is still in beta. <span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line862">A more fully tested implementation is available though the basil command line tool. For this you need to provide partial volume estimates (PVE) at the same resolution as the ASL data. PVE can be obtained from a structural image, for example using <tt class="backtick">FAST</tt>, the high resolution PVE image can then be converted using a transformation matrix from the structural to ASL image spaces, (obtained for example using <tt class="backtick">asl_calib</tt> or <tt class="backtick">FLIRT</tt>). This step is best done using <tt class="backtick">applywarp</tt> to unsure that the values are the total PVE within the voxel, something like: <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line867"><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-1-1"></span><div class="highlight console"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-c77f41d5946277d8899ac8889f311fc5a1d34c7a" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span><span class="LineNumber">applywarp --ref={asl_data} --in={PV_estimate_image} --out={PV_estimate_low_res} --premat={structural_to_ASL_tranformation_matrix} --super --interp=spline --superlevel=4</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span><span class="LineNumber"></span></span>
</pre></div></div><span class="anchor" id="line-45"></span><p class="line867">
<h1 id="Single_delay_data">Single delay data</h1>
<span class="anchor" id="line-46"></span><p class="line874">BASIL was designed to make the most of the information available with multi delay data. With single delay measurements it is not possible to account for variation in bolus arrival time (BAT) and other parameters that are included in the kinetic model. However, if you assume a value for the BAT and other parameters then a CBF value can be determined using the kinetic model. BASIL will work with single delay data and will return the appropriate CBF image, the BAT value can be chosen for the analysis (the default is 0.7). BASIL may be advantageous for single TI data (over simply inverting the relevant model directly) when employing the spatial priors option (the fast option can be used at the same time) or when using partial volume correction. <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line862">If you have a dataset containing just a single TI you will most probably have a whole series of volumes which are pairs of tag and control images where the measurement has been repeated a number of times to improve the signal-to-noise ratio of the final data. This can simply be fed into <tt class="backtick">Asl_gui</tt> to perform perfusion estimation. Otherwise to get a perfusion image you need to do tag-control subtraction and then take the average of these 'difference' images. This can be achieved neatly using asl_file: <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line867"><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-1-3"></span><div class="highlight console"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-6d01ddbe57bbf0110896d04efff2d07a7ce1b312" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span><span class="LineNumber">asl_file --data={raw_data} --ntis=1 --iaf=tc --diff --mean={output_name}</span></span>
<span class="line"><span class="anchor" id="line-2-2"></span><span class="LineNumber"></span></span>
</pre></div></div><span class="anchor" id="line-53"></span><p class="line874">This will provide an image of (relative) perfusion in the same units as the original data. If you want absolute perfusion you will need both an estimate of the M0 of blood and to apply an inverted version of the kinetic model. The latter can be achieved using oxford_asl or BASIL, the former may be possible from the raw data (assuming you do not have background suppressed data) or a separate calibration image using oxford_asl or asl_calib. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-56"></span>
<h1 id="Asl_gui">Asl_gui</h1>
<span class="anchor" id="line-57"></span><p class="line874">The graphical user interface to the BASIL tools can be accessed by typing either Asl (linux) or Asl_gui (OS X) at the command line. It should provide most of the options required for analysis of ASL data inlcuding the majority of the more advanced features of BASIL. <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line867"><strong>Note</strong>: Asl_gui was only officially released with FSL 5.0.3 (any previous versions are unlikely to be very stable and will not adhere to the documentation here). This is still a beta version, we expect to add further features and refine the interface for a future release. <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><p class="line867"><strong>Note</strong>: Changes in oxford_asl in FSL 5.0.6 also apply to asl_gui - namely that inversion efficiency is now included in the calculation (using default values) and that structural images shoud have been brain extracted before input to asl_gui. <span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line874">Asl_gui has four tabs, whose function are failry obvious: <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><ul><li>Data: Specify details of the ASL data here, as well as any supplementary data such as a structural image. <span class="anchor" id="line-66"></span></li><li>Analysis: Options relating to the analysis, primarily the kinetic model and the estimation process. <span class="anchor" id="line-67"></span></li><li>Registration: Options relating to the registration of the results to the structural image. <span class="anchor" id="line-68"></span></li><li>Calibration: Options relating to the estimation of M0a (the equilibrium magnetization of arterial blood) for absolute quantification of pefusion. <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span></li></ul><p class="line874">More details on each tab are provided below. Note that some of the options available on each tab depend on what information is present in your data (set on the data tab). Thus your view of the tab might differ from the one shown here slightly. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line867">
<h2 id="Data">Data</h2>
<span class="anchor" id="line-73"></span><p class="line867"><img alt="data.jpg" class="attachment" src="attachments/BASIL(2f)UserGuide/data.jpg" title="data.jpg" /> <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><ul><li>Input Filename: Select here the ASL data file - it should be a single 4D nifti file, with the individual measurements in the 4th dimension <span class="anchor" id="line-76"></span></li><li>Inversion Times: The inversion times present in the data as a comma separated list. If the data contains multiple repeats of the same indiviual/set of inversion times then it is only necessary to list this once. <span class="anchor" id="line-77"></span></li><li>Bolus duration: For cASL/pcASL this is the labeling duration, for pASL this is the assumed value for the bolus duration that may have been set by a QUIPSSII method or otherwise a reasonable estimate of its value (usually int he range 1-1.5s). If the bolus duration has not be fixed by the acquisition then estimating its value from the data should be selected on the analysis tab. <span class="anchor" id="line-78"></span></li><li>Labeling: Choose the labelling scheme employed. <span class="anchor" id="line-79"></span></li><li>Data is tag-control pairs: Instructs BASIL to do tag control subtraction on the data, turn off if this has already been done. <span class="anchor" id="line-80"></span></li><li>Data order (grouped by): This is only applicable to multi delay ASL data and specifies how the different inversion times appear in the data - see the oxford_asl help section. <span class="anchor" id="line-81"></span></li><li>Static tissue: Specify whether the static tissue has been manipulated in any way (not relevant to data that is not tag-control pairs). This determines what options are available for calibration. <span class="anchor" id="line-82"></span></li><li>Structural image: provide a structural image to which to register the resulting images. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span></li></ul><p class="line867">
<h2 id="Analysis">Analysis</h2>
<span class="anchor" id="line-85"></span><p class="line867"><img alt="analysis.jpg" class="attachment" src="attachments/BASIL(2f)UserGuide/analysis.jpg" title="analysis.jpg" /> <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><ul><li>Output directory: where to put the results. <span class="anchor" id="line-88"></span></li><li>Optional brain mask: BASIL will try to create a brain mask for you using the available data. This permits you to specify your own mask. <span class="anchor" id="line-89"></span></li><li>Output parameter variance: Instructs BASIL also to output the variance images for perfusion (and other paramters) allowing you to assess the uncertainty of estimation and pass these up into a higher-level analysis. <span class="anchor" id="line-90"></span></li><li>Bolus arrival time: The assumed value for the BAT. For multi dealy data BAT is estimated from the data and this value is used as prior information, for single delay data this value can be treated as fixed. The default 0.7 appears to be reasonable for pASL, but logner values ~1.3s have been found to be more suitable for pcASL data. <span class="anchor" id="line-91"></span></li><li>T1/T1b: T1 values for tissue and blood. <span class="anchor" id="line-92"></span></li><li>Use adaptive spatial smoothing on CBF: applys a spatial prior to the perfusion image during estimation, thus making use of neighbourhood information. This is a highly recommended option, but is off by default. <span class="anchor" id="line-93"></span></li><li>Incorporate T1 uncertainty: Permits voxelwise variability in the T1 values, this will primiarly be reflected in the variance images. <span class="anchor" id="line-94"></span></li><li>Include macro vascular componet: Corrects for MV contamination and it suitable where the data contains multiple delays (including the case with flow suppression) <span class="anchor" id="line-95"></span></li><li>Fix bolus duration: Takes the value from the data tab as fixed, turn off to estimate this from the data, where the value on the data tab will be used as prior information. <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span></li></ul><p class="line867">
<h2 id="Registration-1">Registration</h2>
<span class="anchor" id="line-98"></span><p class="line867"><img alt="registration.jpg" class="attachment" src="attachments/BASIL(2f)UserGuide/registration.jpg" title="registration.jpg" /> <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><ul><li>Structural to standard space transform: a .mat from flirt that specifies the transformation from structural to 'standard' space. <span class="anchor" id="line-101"></span></li><li>Alternate standard brain iamge: The 'standard' brain for the above transformation if MNI152 has not been used. <span class="anchor" id="line-102"></span></li><li>Low-resolution structual image: Another structural image of lower resolution (similar to the ASL data) to be used as an intermediary for registration. <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span></li></ul><p class="line867">
<h2 id="Calibration">Calibration</h2>
<span class="anchor" id="line-105"></span><p class="line867"><img alt="calibration.jpg" class="attachment" src="attachments/BASIL(2f)UserGuide/calibration.jpg" title="calibration.jpg" /> <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><ul><li>Perform calibration: by default M0a estimation is not done. <span class="anchor" id="line-108"></span></li><li>Mode: either 'LongTR' or 'Saturation Recovery' - the options present here will depend upon the choice of 'static tissue' on the data tab. <span class="anchor" id="line-109"></span></li><li>M0 calibration image (only for background suppressed data): a separate 'calibration' image to be used for M0a calculation. <span class="anchor" id="line-110"></span></li><li>Use coil sensitivity reference image: A separate image with the same acquisition parameters as the main calibration (either image above or the control images in the ASL data) but with a different coil with flatter sensitivity that used for the main data. <span class="anchor" id="line-111"></span></li><li>Calibration gain: Only relevant if the gain was higher for the ASL data than the calibration image, in which case this is how much higher the gain was for the ASL data (normally this might only apply for backgroudn suppressed data). <span class="anchor" id="line-112"></span></li><li>Reference tissue: Here details of the reference tissue to used for M0a calculation are specified. Voxelwise calculation of M0a cannot be carried out using Asl_gui, use the asl_calib tool directly. <span class="anchor" id="line-113"></span></li><li>Reference tissue type: CSF/white matter/grey matter/none. For the first three options a mask will be generated automatically from the structural image (if you have specfied one). Otherwise you have to add your own mask in the Reference Tissue Mask box. Generally CSF or white matter are good choices, avoid grey matter. <span class="anchor" id="line-114"></span></li><li>Reference T1: T1 of the reference tissue - currently this defaults to the CSF value, so will need to be changed if you change the tissue type (see asl_calib). <span class="anchor" id="line-115"></span></li><li>Reference T2/ Blood T2: T2 values, these are only relevant if you specify the TE of your sequence. T2  of the reference deafults to a CSF value. These should be replaced by T2* values if appropriate. <span class="anchor" id="line-116"></span></li><li>Sequence parameters <span class="anchor" id="line-117"></span></li><li>TR: This is for the longTR mode and should be the Tr of the ASL sequence, unless you have a separate calibration image in which case use that TR. <span class="anchor" id="line-118"></span></li><li>TE: This corrects for T2 differences between the reference tissue and the tissue (using a blood T2 value) using the TE of the data (which is assumed to be the same as any calibration image). <span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span></li></ul><p class="line867">
<h2 id="Output">Output</h2>
<span class="anchor" id="line-121"></span><p class="line862">The outputs from <tt class="backtick">Asl_gui</tt> are a resting perfusion image called <tt class="backtick">perfusion.nii.gz</tt>, which provides blood flow in relative (scanner) units, and an arrival time image called <tt class="backtick">arrival.nii.gz</tt>. If a calibration has been performed then a further image <tt class="backtick">perfusion_calib.nii.gz</tt> is also produced, which is a flow map in absolute units (ml/100g/min). Results in standard space (assuming that the transformation matrix has been supplied) will appear in the output directory directly. Results in the native space of the data and structural space (along with any transformation matrices from the registration process) will appear in their own subdirectories. <span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line862">If calibration was performed then a separate subdirectory will be created and will contain text file called <tt class="backtick">M0b.txt</tt> that records the estimated M0 value from arterial blood. If a reference tissue mask was not supplied then the automatically generated one will also be saved in as ref<tt class="backtick">mask.nii.gz</tt> <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-126"></span>
<h1 id="Oxford_ASL">Oxford_ASL</h1>
<span class="anchor" id="line-127"></span><p class="line867"><tt class="backtick">Oxford_ASL</tt> is an automated command line utility that processes ASL data to produce a calibrated map of resting state tissue perfusion. A typical usage would be: <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line867"><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-1-5"></span><div class="highlight console"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-4c7433ffea30cf2fb8c3c1ea95fedaa1a42bbe63" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span><span class="LineNumber">oxford_asl -i [asl_data] -s [struct_image] -t [struct2std_trans.mat] -c [M0_calib_image] --tis 0.2,0.4,0.6,0.8,1.0,1.2,1.4,1.6,2.0,2.2</span></span>
<span class="line"><span class="anchor" id="line-2-3"></span><span class="LineNumber"></span></span>
</pre></div></div><span class="anchor" id="line-132"></span><p class="line862">This command would process the data specified by <tt class="backtick">[asl_data]</tt> with the list of inverstion times <tt class="backtick">--tis</tt> used in the data collection. The resulting tissue perfusion map is registered into standard space by way of the structural image <tt class="backtick">[struct_image]</tt> and structural to standard transformation matrix <tt class="backtick">[struct2std_trans.mat]</tt>. Finally a calibrated perfusion map (in ml/100g/min) is produced using the calibration image <tt class="backtick">[M0_calib]</tt> and an automatically generated CSF mask. In this case the output image(s) will be placed in the current directory. <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line862">This performs calibration to get CBF in physiological units using the supplied calibration image. More advanced calibration options (and the use of saturation recovery of the control images) can be achieved using <tt class="backtick">asl_calib</tt> separately. <tt class="backtick">Oxford_asl</tt> will try to register the resulting CBF image to the structural image if provided. <strong>It is very important to inspect whether the registration has worked by examining the final result</strong>. There are a couple of options that can improve the robustness of registration. Advanced custom registration can be done using the <tt class="backtick">native_space</tt> results directly and either <tt class="backtick">asl_reg</tt> or <tt class="backtick">flirt</tt>. <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line867">
<h2 id="Changes_from_FSL_5.0.6_onward">Changes from FSL 5.0.6 onward</h2>
<span class="anchor" id="line-137"></span><p class="line862">Oxford_asl was modified in 5.0.6 to make it more consistent with the (upcoming) ASL white paper. Thus T1 values differ from the previous release and the inversion efficiency is now included by default (this can be 'turned off' by setting <tt class="backtick">--alpha&nbsp;1</tt>) - the new defaults for these can be found by typing <tt class="backtick">oxford_asl</tt> on the command line and consulting the usage information. Oxford_asl now also expects all structural images to have already been brain extracted (in the past BET was run internally). This now leaves it up to the user to choose their preferred BET options and get the brain extraction they wish without any further modification by oxford_asl. <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line867">
<h2 id="Output-1">Output</h2>
<span class="anchor" id="line-140"></span><p class="line862">The outputs from <tt class="backtick">Oxford_ASL</tt> are a resting state perfusion image called <tt class="backtick">perfusion.nii.gz</tt>, which provides blood flow in relative (scanner) units, and an arrival time image called <tt class="backtick">arrival.nii.gz</tt>. If a calibration image has been supplied then a further image <tt class="backtick">perfusion_calib.nii.gz</tt> is also produced, which is a flow map in absolute units (ml/100g/min). <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><p class="line862">If calibration was performed then a text file called <tt class="backtick">M0b.txt</tt> will be created that saves the estimated M0 value from arterial blood. If a CSF mask was not supplied then the automatically generated one will also be saved in the output directory as <tt class="backtick">csf_mask.nii.gz</tt> <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><p class="line862">A subdirectory is also created called <tt class="backtick">native_space</tt> in which perfusion and arrival time images in the native resolution of the ASL data are saved. These are useful if you find the registration to be unsatisfactory, allowing a new registration to be performed without having to repeat the main analysis. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><p class="line867">
<h2 id="Usage">Usage</h2>
<span class="anchor" id="line-147"></span><p class="line862">Typing <tt class="backtick">oxford_asl</tt> with no options will give the basic usage information, the following is a more detailed version: <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><ul><li><p class="line891"><tt class="backtick">-i&nbsp;[asl_data]</tt>        this is the ASL data with the individual ASL images stacked in the time (4th) dimension. The number of volumes should match the number of TIs. <span class="anchor" id="line-150"></span></li><li><p class="line891"><tt class="backtick">--tis&nbsp;TI1,TI2,TI3...</tt>         This option specifies the list of inversion times used in the data acquisition, a comma separated list of values should be provided (that matches the order in the data). If the data contains multiple repeats of the same set of TIs then it is only necessary to list the unique TIs. In this case <tt class="backtick">oxford_asl</tt> will take the mean of the values for each TI before model-fitting (if you dont want it to do this then list out all the TIs for every volume in the data explicitly). <span class="anchor" id="line-151"></span></li><li><p class="line891"><tt class="backtick">-o&nbsp;</tt>(optional)<tt class="backtick">&nbsp;[output_directory]</tt>   use this to place the result in a different directory to the current working directory. <span class="anchor" id="line-152"></span></li><li><p class="line891"><tt class="backtick">-s</tt> (optional) <tt class="backtick">[struct_image]</tt>       high resolution structural image (assumed to be T1 weighted or similar). If this is not provided then results will be provided in native space only. <span class="anchor" id="line-153"></span></li><li><p class="line891"><tt class="backtick">-t</tt> (optional) <tt class="backtick">[struct2std_trans.mat]</tt>       transformation matrix that takes the structural image into standard space. This matrix is an output from the registration process carried out by FLRIT (this is a normal part of FEAT processing for fMRI data for a subject). If this is not supplied data will be output in structural space. <span class="anchor" id="line-154"></span></li><li><p class="line891"><tt class="backtick">-S</tt> (optional) <tt class="backtick">[std_image]</tt>  use to specify the standard brain to which registration takes place - this should be the same image as was used in the production of the structural to standard transformation matrix. By default the MNI152_T1_2mm image is used, this is commonly used in other FSL tools. <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span></li></ul><p class="line867">
<h3 id="acquisition_specific">acquisition specific</h3>
<span class="anchor" id="line-157"></span><ul><li><p class="line891"><tt class="backtick">--casl</tt>       Data was acquired using cASL or pcASL labelling. <span class="anchor" id="line-158"></span></li><li><p class="line891"><tt class="backtick">--bolus&nbsp;[bolus_duration]</tt>     use this to specify the duration of the ASL tagging bolus used in the sequence (in seconds). This is assumed to be 1 second by default, the actual bolus length is estimated as part of the processing (unless you supply the <tt class="backtick">--fixbolus</tt> option) - this value is used as the intial guess. <span class="anchor" id="line-159"></span></li><li><p class="line891"><tt class="backtick">--t1&nbsp;[T1_value]</tt>      The T1 value of tissue, 1.3 s by default (assuming acquisition at 3T). <span class="anchor" id="line-160"></span></li><li><p class="line891"><tt class="backtick">--t1b&nbsp;[T1b_value]</tt>    The T1 value of arterial blood, 1.6 s by default (assuming acquisition at 3T). <span class="anchor" id="line-161"></span></li><li><p class="line891"><tt class="backtick">--slicedt&nbsp;[timing_difference_value]</tt>  For multi-slice acquisitions where superior slices are acquired later than those below. This provides the increase in time after labeling for a superior slice relative to the one directly below. It is assumed that the TIs provided refer to the lowest slice in the dataset. <span class="anchor" id="line-162"></span></li><li><p class="line891"><tt class="backtick">--artoff</tt>     Turn off correction for signal arising from ASL signal still within the (macro) vascualture, this might be appropriate if the acquisition employed flow suppression. <span class="anchor" id="line-163"></span></li><li><p class="line891"><tt class="backtick">--fixbolus</tt>   Turn off the automatic estimation of bolus duration, this might be appropriate if the bolus duration is well defined by the acquisition sequence (often true for cASL and pcASL, as well as when using pASL plus QUIPSSII). <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span></li></ul><p class="line867">
<h3 id="Calibration-1">Calibration</h3>
<span class="anchor" id="line-166"></span><ul><li><p class="line891"><tt class="backtick">-c&nbsp;[M0_calib_image]</tt>  specifies the M0 calibration image that is used to get flow values in absolute units. This should be an image with the repeated measurements stacked in the time dimension. <span class="anchor" id="line-167"></span></li><li><p class="line891"><tt class="backtick">--csf</tt> (optional)<tt class="backtick">&nbsp;[csf_mask]</tt>        Image in the same space as the structural (or low res structural image if supplied) that is a mask of voxels containing CSF to be used in calibration. This is a further option of the calibration step and allows the CSF mask to be manually specified if the automated procedure fails. <span class="anchor" id="line-168"></span></li><li><p class="line891"><tt class="backtick">--cgain</tt> (optional) <tt class="backtick">[relative_gain_value]</tt>   If the calibration image has been acquired with a different gain to the ASL data this can be specified here. For example, when using background suppression the raw ASL signal will be much smaller than the (non background suppressed) calibration image so a higher gain might be employed in the acquisition. <span class="anchor" id="line-169"></span></li><li><p class="line891"><tt class="backtick">--t1csf</tt> (optional) <tt class="backtick">[T1&nbsp;value&nbsp;for&nbsp;CSF&nbsp;in&nbsp;s]</tt>         Supply a value for the T1 of CSF to be used in the calibration process. Default values are used by asl_calib based on a 3T field strength (these can be checked by calling <tt class="backtick">asl_calib</tt> at the command line). <span class="anchor" id="line-170"></span></li><li><p class="line891"><tt class="backtick">--te</tt> (optional) <tt class="backtick">[Echo&nbsp;time&nbsp;for&nbsp;readout&nbsp;in&nbsp;ms]</tt>      Set the echo time for the reaodut so that T2(*) effects are taken into account in the calibration. If this is not supplied then TE = 0 ms is assumed, i.e. T2(*) effects are negligible. Default values are assumed by <tt class="backtick">asl_calib</tt> for T2(*) values, you might wish to treat these with caution as these are estimates based on the literature. <span class="anchor" id="line-171"></span></li><li><p class="line891"><tt class="backtick">--t2star</tt> (optional)  Tells oxford_asl to correct for T2* rather than T2 effects. This simply tells asl_calib to use the default values for T2* in place of T2 in the calculations. <span class="anchor" id="line-172"></span></li><li><p class="line891"><tt class="backtick">--t2csf</tt> (optional) <tt class="backtick">[T2&nbsp;value&nbsp;for&nbsp;CSF]</tt>      Supply a value for the T2 of CSF to be used in the calibration process, only relevant if you supply the TE value. Default values are used by <tt class="backtick">asl_calib</tt> based on a 3T field strength (these can be checked by calling <tt class="backtick">asl_calib</tt> at the command line). <span class="anchor" id="line-173"></span></li><li><p class="line891"><tt class="backtick">--t2bl</tt> (optional) <tt class="backtick">[T2&nbsp;value&nbsp;for&nbsp;blood]</tt>     Supply a value for the T2 of blood to be used in the calibration process, only relevant if you supply the TE value. Default values are used by <tt class="backtick">asl_calib</tt> based on a 3T field strength (these can be checked by calling <tt class="backtick">asl_calib</tt> at the command line). <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span></li></ul><p class="line867">
<h3 id="Registration-2">Registration</h3>
<span class="anchor" id="line-176"></span><ul><li><p class="line891"><tt class="backtick">-r</tt> (optional) <tt class="backtick">[low_res_struct]</tt>      low resolution structural image used as an extra step in the registration to improve resulting transformation. <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span></li><li class="gap"><p class="line891"><tt class="backtick">--regfrom</tt> (optional) <tt class="backtick">[reg_source]</tt>  An alternative image to use as the basis of registration. This should be the same resolution as the ASL data and aligned to it. The raw data before tag-control differencing or the calibration image are often a better reference for registration than the CBF image. <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span></li></ul><p class="line867">
<h3 id="Analysis-1">Analysis</h3>
<span class="anchor" id="line-181"></span><ul><li><p class="line891"><tt class="backtick">--spatial</tt>    Use spatial prior on the estimated CBF image. This exploits the spatial homogeneity (or smoothness) of the CBF image. This is somewhat similar to spatial smoothing the raw data, but it is adaptive and does not interact unfavorably with the non-linear kinetic curve modelling. <span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span></li><li class="gap"><p class="line891"><tt class="backtick">--infert1</tt>     Incorporate uncertainty in the T1 values into the analysis. <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span></li><li class="gap"><p class="line891"><tt class="backtick">--bat&nbsp;[BAT_value]</tt>    Bolus arrival time value (in seconds). BAT is estimated directly from the data, but this option can be used to supply a different prior estimate from that used by default (0.7 seconds). <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-188"></span>
<h1 id="BASIL">BASIL</h1>
<span class="anchor" id="line-189"></span><p class="line874">To run BASIL on resting-state ASL data you will need: <span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><ul><li>ASL difference data at multiple TIs, differencing of tag and control images should have been done already. <span class="anchor" id="line-192"></span></li><li>Details of the sequence, i.e. inversion times, bolus duration, etc. <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span></li></ul><p class="line867">
<h2 id="Multi-step_inference">Multi-step inference</h2>
<span class="anchor" id="line-195"></span><p class="line874">BASIL runs in multiple steps increasing the model complexity at each stage. A rough overview of the process would be: <span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><ol type="1"><li>STEP 1: Bayesian inference - Inference for CBF and arrival time (and optionally bolus duration) <span class="anchor" id="line-198"></span></li><li>STEP 2+: Bayesian inference - further parameters of the model can be inferred from the data, see below. <span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span></li></ol><p class="line867">
<h2 id="Calling_BASIL">Calling BASIL</h2>
<span class="anchor" id="line-201"></span><p class="line874">BASIL can be called from the command line with the following information: <span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><ul><li><p class="line891"><tt class="backtick">-i</tt> Input file containing tag-control differenced data. <span class="anchor" id="line-204"></span></li><li><p class="line891"><tt class="backtick">-m</tt> Brain mask for the data. <span class="anchor" id="line-205"></span></li><li><p class="line891"><tt class="backtick">-o</tt> Name of directory into which results are to be written (default is a subdirectory called basil within the input directory). <span class="anchor" id="line-206"></span></li><li><p class="line891"><tt class="backtick">-@</tt> Model and sequence parameters (to be passed to FABBER). <span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span></li></ul><p class="line874">BASIL provides a number of options to access more advanced parts of the kinetic curve models: <span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><ul><li><p class="line891"><tt class="backtick">--infertau</tt> Infer the bolus duration from the data. <span class="anchor" id="line-211"></span></li><li><p class="line891"><tt class="backtick">--infert1</tt> Infer the values of T1 and T1b from the data. <span class="anchor" id="line-212"></span></li><li><p class="line891"><tt class="backtick">--inferart</tt> Infer an arterial compartment in the data. <span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span></li></ul><p class="line874">BASIL also has a few more advanced options: <span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><ul><li><p class="line891"><tt class="backtick">--fast</tt> Perform the analysis in a single step, mostly for use with --spatial. <span class="anchor" id="line-217"></span></li><li><p class="line891"><tt class="backtick">--spatial</tt> Apply a spatial smoothing prior to the estimated CBF image, this is preferable to spatial smoothing of the data before analysis. <span class="anchor" id="line-218"></span></li><li><p class="line891"><tt class="backtick">--pvgm</tt> / <tt class="backtick">--pvwm</tt> Perform partial volume correction with the supplied partial volume estimates for grey and white matter (these should be the same resolution as the ASL data). <span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span></li></ul><p class="line867">
<h3 id="A.60-.40.60_The_parameter_file">`-@` The parameter file</h3>
<span class="anchor" id="line-221"></span><p class="line874">BASIL requires a text file in which you specify the model you want to use along with its parameters, plus information about the collected data. This information is passed directly to FABBER each time it is called. A generic BASIL options file might look like (preceding a line with # indicates it is a comment and will be ignored by FABBER): <span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><p class="line867"><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-1-7"></span><div class="highlight console"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f14426ed967ea1537674494765fe8269b8a4ee77" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span><span class="ID">#</span> Sequence/scanner parameters</span>
<span class="line"><span class="anchor" id="line-2-4"></span><span class="LineNumber">--t1=1.3</span></span>
<span class="line"><span class="anchor" id="line-3-1"></span><span class="LineNumber"></span><span class="LineNumber">--t1b=1.5</span></span>
<span class="line"><span class="anchor" id="line-4-1"></span><span class="LineNumber"></span><span class="LineNumber">--tau=0.7</span></span>
<span class="line"><span class="anchor" id="line-5-1"></span><span class="LineNumber"></span><span class="LineNumber"></span></span>
<span class="line"><span class="anchor" id="line-6-1"></span><span class="LineNumber"></span><span class="ID">#</span> Data information</span>
<span class="line"><span class="anchor" id="line-7-1"></span><span class="LineNumber">--repeats=10 --ti1=0.25 --ti2=0.5 --ti3=0.75 --ti4=1.0 --ti5=1.25 --ti6=1.5 --ti7=1.75 --ti8=2.0</span></span>
<span class="line"><span class="anchor" id="line-8-1"></span><span class="LineNumber"></span></span>
</pre></div></div><span class="anchor" id="line-232"></span><p class="line867">
<h4 id="Resting-state_ASL_model">Resting-state ASL model</h4>
<span class="anchor" id="line-233"></span><p class="line874">The Kinetic curve model for resting state ASL is built into FABBER and called by BASIL, for more information see: <span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><p class="line867"><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><div class="references"><span class="anchor" id="line-1-9"></span><p class="line874">Buxton, R. B., L. R. Frank, et al., 'A general kinetic model for quantitative perfusion imaging with arterial spin labeling', Magnetic Resonance in Medicine 40(3): 383-396, 1998. </div><span class="anchor" id="line-238"></span><p class="line874">By default BASIL assumes that your data is pulsed ASL (pASL), if you are using continuous (cASL) or pseudo continuous (pcASL) labelling then you should set the cASL option: <span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><ul><li><p class="line891"><tt class="backtick">--casl</tt> use the cASL version of the model. <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span></li></ul><p class="line874">For the model you can set the appropriate values of T1 (and T1b) as well as the length of the bolus as set by your sequence, if these are not specified in the parameter file then the default values are used: <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><ul><li><p class="line891"><tt class="backtick">--t1=</tt> The value of T1 (default 1.3 seconds). <span class="anchor" id="line-245"></span></li><li><p class="line891"><tt class="backtick">--t1b=</tt> The value of T1b (default 1.5 seconds). <span class="anchor" id="line-246"></span></li><li><p class="line891"><tt class="backtick">--tau=</tt> Temporal bolus length (default is infinite), a fixed bolus length is often implemented using QUIPSS2 for example. If the bolus length is not fixed, e.g. FAIR using a coil with limited spatial extent, then BASIL can estimate the bolus length, more... <span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span></li></ul><p class="line867">
<h4 id="Data-1">Data</h4>
<span class="anchor" id="line-249"></span><p class="line862">Alongside model information the parameter file also contains information about the data, including the inversion times and how many repeats at each inversion time is contained in the file: Currently we recommend that the repeated measurements at each TI are averaged to produce a single measurement (this can be achieved using <tt class="backtick">asl_file</tt>) - this appears to produce an improvement in convergence in difficult voxels and also speeds up processing. <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><ul><li><p class="line891"><tt class="backtick">--repeats=</tt> The number of repeats of each inversion time in the data (default is 1). NOTE if you have data that has already been averaged at each inversion time then <tt class="backtick">--repeats=1</tt>, since the data only contains one repeat at each TI. <span class="anchor" id="line-252"></span></li><li><p class="line891"><tt class="backtick">--ti[n]=</tt> The time (in seconds) of the <em>n</em>th inversion time. You should specify each inversion time individually in the order that they appear in the data. <span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span></li></ul><p class="line862">BASIL can process data in the unaveraged format: in which case it is assumed that the data comes with the individual time points in the 4th dimension, with repeats at each inversion time coming in blocks, manipulation of the data can be done using <tt class="backtick">asl_file</tt>. <span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><p class="line874">For example: the data contains 8 readings taken at 4 TIS (0.5, 1, 1.5, 2 seconds), repeated twice and is presented to BASIL with each TI grouped together <span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><p class="line874">i.e. TI1 TI1 TI2 TI2 TI3 TI3 TI4 TI4 <span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><p class="line874">Hence the parameter file would contain <span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><p class="line867"><tt class="backtick">--ti1=0.5&nbsp;--ti2=1&nbsp;--ti3=1.5&nbsp;--ti4=2&nbsp;--repeats=2</tt> <span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><p class="line874">NOTE that the number of TIs specified multiplied by the number of repeats should equal the number of time points in the 4D input data set. <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><p class="line862">It is possible to deal with more complicated data by specifying an individual <tt class="backtick">--ti[n]=</tt> for every time point in the data, for the above example this would give: <span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><p class="line867"><tt class="backtick">--ti1=0.5&nbsp;--ti2=0.5&nbsp;--ti3=1&nbsp;--ti4=1&nbsp;--ti5=1.5&nbsp;--ti6=1.5&nbsp;--ti7=2&nbsp;--ti8=2</tt> <span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line867">
<h2 id="Results">Results</h2>
<span class="anchor" id="line-271"></span><p class="line874">Within the output directory a number of subdirectories will be created containing the results from FABBER from each step these comprise: <span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><ul><li><p class="line891"><tt class="backtick">info.txt</tt>: Text file containing information from BASIL about what was done in this step. <span class="anchor" id="line-274"></span></li><li><p class="line891"><tt class="backtick">paramnames.txt</tt>: A list of names of the parameters inferred, these will correspond with the names of the results files. <span class="anchor" id="line-275"></span></li><li><p class="line891"><tt class="backtick">mean_{paramname}.nii.gz</tt>: The parameter estimate image for paramname. <span class="anchor" id="line-276"></span></li><li><p class="line891"><tt class="backtick">zstat_{paramname}.nii.gz</tt>: A pseudo z-statistic image for paramname, uses variance information to give a measure of the confidence with which that parameter deviates from 0. <span class="anchor" id="line-277"></span></li><li><p class="line891"><tt class="backtick">finalMVN.nii.gz</tt>: All the parameter estimates and variances (including noise parameters) in one file. This can be interrogated with <tt class="backtick">mvntool</tt> or within MATLAB using <tt class="backtick">read_fabber.m</tt>. <span class="anchor" id="line-278"></span></li><li><p class="line891"><tt class="backtick">logfile</tt>: The logfile from FABBER. <span class="anchor" id="line-279"></span></li><li><p class="line891"><tt class="backtick">FreeEnergy.nii.gz</tt>: Images of the free energy from FABBER, see references for more information. <span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span></li></ul><p class="line862">A function <tt class="backtick">basil_var</tt> is also supplied that when applied to a basil results directory will work its way through all the steps extracting the images of variance for each parameter and writing it to <tt class="backtick">var_{paramname}.nii.gz</tt> <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><p class="line867">
<h2 id="Noise_Model_.28Advanced_option.29">Noise Model (Advanced option)</h2>
<span class="anchor" id="line-284"></span><p class="line862">BASIL assumes that you wish to use a standard white noise model to analyse resting-ASL data. This model assumes that the noise in each voxel can be described by a single noise magnitude, this is sufficient in practice for most ASL data. If you are feeling adventurous (or have good reason) you may instruct <tt class="backtick">FABBER</tt> to use different noise magnitudes for different sections of the input data, e.g. a different value at each inversion time. This is done in the parameter file using the <tt class="backtick">--noise-pattern=</tt> option, which is used as follows: Taking the example of data with 4 TIs each repeated 5 times, to get a different noise magnitude at each inversion time use: <tt class="backtick">--noise-pattern=11111222223333344444</tt> i.e. the first 5 entries correspond to the first TI and these should use the first noise magnitude, the next 5 entries are the next TI and next noise magnitude etc. NOTE: if you have more than 9 TIs then for the 10th TI and onward letters should be used in place of numbers starting with a, i.e. for 12 TIs and 2 repeats: <tt class="backtick">--noise-pattern=112233445566778899aabbcc</tt> NOTE: if you have only a small number of repeats (like these examples) then this more complex noise modelling is probably not a good idea. <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-287"></span>
<h1 id="QUASIL">QUASIL</h1>
<span class="anchor" id="line-288"></span><p class="line862">QUASIL is a special implementation of BASIL specifically designed to exploit the features of QUASAR ASL data. It uses the same two component (tissue plus macro vascular signal) model that is employed by BASIL, but it has been extended to use all the information provided by the various phases for flow suppression provided by the QUASAR sequence. QUASIL uses information from the full QUASAR dataset to produce CBF images in absolute units (using an implementation of <tt class="backtick">asl_calib</tt>). QUASIL also provides the option to performed a 'model-free' analysis using a very similar methodology as presented in the original QUASAR paper. <span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><p class="line874">More information on the model used can be found in: <span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><p class="line867"><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><div class="references"><span class="anchor" id="line-1-10"></span><p class="line862">Chappell, M. A., Woolrich, M. W., Petersen, E. T., Golay, X., &amp; Payne, S. J. (2012). Comparing model-based and model-free analysis methods for QUASAR arterial spin labeling perfusion quantification. Magnetic resonance in medicine. doi:10.1002/mrm.24372 </div><span class="anchor" id="line-295"></span><p class="line874">More information on the model-free method can be found in the original QUASAR paper: <span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><p class="line867"><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><div class="references"><span class="anchor" id="line-1-11"></span><p class="line862">Petersen, E., Lim, T., &amp; Golay, X. (2006). Model-free arterial spin labeling quantification approach for perfusion MRI. Magnetic resonance in medicine , 55(2), 219232. doi:10.1002/mrm.20784 </div><span class="anchor" id="line-300"></span><p class="line867">
<h2 id="Usage-1">Usage</h2>
<span class="anchor" id="line-301"></span><p class="line874">Since the acquisition of data using QUASAR is very well defined there are far fewer options to set with QUASIL than a typical BASIL analysis. NOTE that QUASIL expects the data without tag-control subtraction having been performed. A typical command line usage would be: <span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line867"><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-1-12"></span><div class="highlight console"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-3d52d45db49b64be459743b48a85f9a3503639c2\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-3d52d45db49b64be459743b48a85f9a3503639c2" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-3d52d45db49b64be459743b48a85f9a3503639c2_1">   1</a> </span><span class="LineAnchor" id="CA-3d52d45db49b64be459743b48a85f9a3503639c2_1"></span><span class="anchor" id="line-1-13"></span><span class="LineNumber">quasil -i [asl_data] -o [output_directory]</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-3d52d45db49b64be459743b48a85f9a3503639c2_2">   2</a> </span><span class="LineAnchor" id="CA-3d52d45db49b64be459743b48a85f9a3503639c2_2"></span><span class="anchor" id="line-2-5"></span><span class="LineNumber"></span></span>
</pre></div></div><span class="anchor" id="line-306"></span><p class="line862">This would carry out a model-based analysis of the ASL data and provide voxelwise estimates of CBF, arrival time and arterial blood volume (aBV). The calibration of the data to the equilibrium magnetization is also carried out as part of the processing so that the perfusion image is provided in absolute units (ml/100ml/min). Additionally, the perfusion image prior to calibration is also provided: <tt class="backtick">perfusion_raw</tt>. <span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><p class="line862">Typing <tt class="backtick">quasil</tt> with no options will give basic usage information. <span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><p class="line867">
<h3 id="Extended_options">Extended options</h3>
<span class="anchor" id="line-311"></span><ul><li>-i [asl_data}   The QUASAR ASL data in Nifti file format. The data order should 'as acquired', i.e. as blocks of TIs measured in the different phases of flow suppression. <span class="anchor" id="line-312"></span></li><li>-o (optional) [output_directory]        use this to place the result in a different directory to the current working directory. <span class="anchor" id="line-313"></span></li><li>-m (optional) [brain_mask]      Use this to provide a brain mask in which data analysis should take place. If this is not set a mask will be generated automatically from the data. <span class="anchor" id="line-314"></span></li><li>--mfree         Do a 'model-free' rather than model based analysis of the data. <span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span></li></ul><p class="line867">
<h2 id="Calibration-2">Calibration</h2>
<span class="anchor" id="line-317"></span><p class="line862">The calibration is carried out by <tt class="backtick">asl_calib</tt> and uses the saturation recovery of the control images. M0 of the tissue is estimated voxelwise from fitting a saturation recovery model and from this a voxelwise estimate of M0 of the blood is derived and applied to the estimated perfusion images. More details are given in the references above. An alternative is to calculate the M0 of CSF within a CSF mask and from this estimate a single value of M0 of arterial blood, as is done by <tt class="backtick">oxford_asl</tt> by default. This can be achieved using <tt class="backtick">asl_calib</tt> and the resulting M0 value applied to the <tt class="backtick">perfusion_raw</tt> image. <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-320"></span>
<h1 id="Calibration_.28asl_calib.29">Calibration (asl_calib)</h1>
<span class="anchor" id="line-321"></span><p class="line874">ASL tag-control difference data can be used to quantify perfusion. However, the values obtained are not absolutely quantified in conventional units, to get absolute CBF quantification it is also necessary to estimate the equilibrium magnetization of arterial blood. <span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><p class="line874">The M0 value for arterial blood can be estimated indirectly from a measurement in a reference 'tissue', such as the CSF, either: <span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><ul><li>LongTR: From a separate calibration image that uses the same acquisition as the ASL data, but contains no inversion (i.e. a 'control' image) and no background suppression. Ideally the images would be acquired with a very long TR. However, it is possible to account for shorter TR values, for example matching that the of ASL sequence, with an estimate of the T1 of the reference 'tissue'. <span class="anchor" id="line-326"></span></li><li><p class="line891"><a class="nonexistent" href="./SatRecov.html">SatRecov</a>: From the saturation recovery of the control images in the ASL data sequence, if a presaturation has been applied in the imaging region. <span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span></li></ul><p class="line874">asl_calib performs the necessary steps to obtain the M0 of blood value from such a calibration images. It can also: <span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><ul><li>LongTR method: produce a spatial sensitivity estiamte for the coil used for aquisition, if another calibration image is supplied that was acquired using some other coil (assumed to have a flat spatial sensitivity) as a reference (e.g. the body coil). <span class="anchor" id="line-331"></span></li><li><p class="line891"><a class="nonexistent" href="./SatRecov.html">SatRecov</a> method: produce an estimated T1 of tissue image for use in kinetic curve model fitting. <span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span></li></ul><p class="line867">
<h2 id="asl_calib_usage">asl_calib usage</h2>
<span class="anchor" id="line-334"></span><p class="line862">Typing the <tt class="backtick">asl_calib</tt> with no options will give the basic usage information, the following is a more detailed version: <span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><ul><li><p class="line891"><tt class="backtick">-c&nbsp;[calib_data]</tt>    Calibration data in Nifti file format with the individual images stacked in the time dimension. <span class="anchor" id="line-337"></span></li><li><p class="line891"><tt class="backtick">-s&nbsp;[structural_image]</tt>      Structural image used for determining reference 'tissue' mask (not required if reference 'tissue' mask is supplied, see below). <span class="anchor" id="line-338"></span></li><li><p class="line891"><tt class="backtick">-t&nbsp;[asl-&gt;structural_transformation_matrix]</tt>         Transformation matrix for ASL images to structural image space, e.g. from <tt class="backtick">asl_reg</tt>, (not required if reference 'tissue' mask is supplied, see below). <span class="anchor" id="line-339"></span></li><li><p class="line891"><tt class="backtick">--mode&nbsp;[mode]</tt>      Specify what form the calibration data takes, options are: <tt class="backtick">longtr</tt>, <tt class="backtick">satrecov</tt>. See below for mode specific options. <span class="anchor" id="line-340"></span></li><li><p class="line891"><tt class="backtick">--tissref&nbsp;[Reference_tissue_type]</tt>  The 'tissue' type to use as a reference, see below, options are: <tt class="backtick">csf</tt>, <tt class="backtick">wm</tt>, <tt class="backtick">gm</tt>, <tt class="backtick">none</tt>. <span class="anchor" id="line-341"></span></li><li><p class="line891"><tt class="backtick">-te&nbsp;[TE_value]</tt>     TE of the calibration sequence in seconds, deafult is 0 s. <span class="anchor" id="line-342"></span></li><li><p class="line891"><tt class="backtick">-i&nbsp;[CBF_image]</tt>     A CBF image for calibration. This should be still at the native resolution of the ASL data. <span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span></li></ul><p class="line867">
<h3 id="Output_options">Output options</h3>
<span class="anchor" id="line-345"></span><ul><li><p class="line891"><tt class="backtick">-o&nbsp;[absolute_CBF_image_name]</tt>       File to which absolute CBF image should be saved, if input image has been supplied with <tt class="backtick">-i</tt>. <span class="anchor" id="line-346"></span></li><li><p class="line891"><tt class="backtick">--Mo&nbsp;[M0_value_save_file]</tt>  The estimated M0 value of arterial blood will be saved as text to a file of this name. This can then be used to convert a CBF image into absolute values. <span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span></li></ul><p class="line867">
<h3 id="Extended_Options">Extended Options</h3>
<span class="anchor" id="line-349"></span><ul><li><p class="line891"><tt class="backtick">-m&nbsp;[CSF_mask]</tt>      Provide a 'tissue' reference mask, e.g. hand drawn, instead of relying upon automated mask creation. If a mask is supplied the structural image and ASL to structural transformation are no longer required. <span class="anchor" id="line-350"></span></li><li><p class="line891"><tt class="backtick">-bmask&nbsp;[brain_mask]</tt>        A mask of the brain in (ASL native space), this will be used for sensitivity estimation (LongTR method) or T1 estimation (<a class="nonexistent" href="./SatRecov.html">SatRecov</a> method). If not supplied a brain mask will be generated automatically from the calibration data if it is needed, this option allows the same mask from other processing steps to be employed for consistency. <span class="anchor" id="line-351"></span></li><li><p class="line891"><tt class="backtick">-t2star</tt>    Tells <tt class="backtick">asl_calib</tt> to do T2* correction rather than T2 correction. This option simply alters which set of default T2(*) values are used. <span class="anchor" id="line-352"></span></li><li><p class="line891"><tt class="backtick">-t1r&nbsp;[T1_reference_tissue]</tt>         T1 (in seconds) for the reference tissue, the defaults for the different <tt class="backtick">--tissref</tt> options are (based on 3T): csf 3.4, gm, 1.3, wm 1.0. <span class="anchor" id="line-353"></span></li><li><p class="line891"><tt class="backtick">-t2r&nbsp;[T2_reference_tissue]</tt>         T2(*) (in miliseconds) for the reference tissue, the defaults for the different <tt class="backtick">--tissref</tt> options are (based on 3T) T2/T2*: csf 750/500, gm, 100/50, wm 50/20. These defaults are general estimates based on the literature and should be used with care. <span class="anchor" id="line-354"></span></li><li><p class="line891"><tt class="backtick">-t2b&nbsp;[T2_blood]</tt>    T2 (in miliseconds) for blood, the default is 150/50 (T2/T2*). The defaults are a general estimate based on the literature and should be used with care. <span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span></li></ul><p class="line867">
<h3 id="Mode_specific_options">Mode specific options</h3>
<span class="anchor" id="line-357"></span><p class="line867">
<h4 id="LongTR">LongTR</h4>
<span class="anchor" id="line-358"></span><ul><li><p class="line891"><tt class="backtick">--tr&nbsp;[TR_value]</tt>    TR of the calibration sequence in seconds, default is 3.2 s. <span class="anchor" id="line-359"></span></li><li><p class="line891"><tt class="backtick">--cagin&nbsp;[calibration_gain]</tt>         The relative gain of the ASL data to that of the calibration image, default 1. This allows for the case where the ASL data has been acquired with a higher gain than the calibration images, for example where background suppression was used allowing for a higher gain to be set for the ASL data. <span class="anchor" id="line-360"></span></li><li><p class="line891"><tt class="backtick">-cref&nbsp;[calibration_reference_image]</tt>        A further image squired using the same parameters as the main calibration file, but with a different coil to be used as a reference to calculate the sensitivity of the coil used for the main ASL data. <span class="anchor" id="line-361"></span></li><li><p class="line891"><tt class="backtick">-osen&nbsp;[sensitivity_image_out_file]</tt>         Specify where the sensitivity file can be saved, if a reference image has been supplied with<tt class="backtick">&nbsp;--cref</tt>. This can be used later to correct an estimated CBF image for coil sensitivity. <span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span></li><li class="gap"><p class="line891"><tt class="backtick">-isen&nbsp;[sensitivity_image]</tt>  provide a sensitivity image (that matches the calibration image). <span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span></li></ul><p class="line867">
<h4 id="SatRecov">SatRecov</h4>
<span class="anchor" id="line-366"></span><ul><li><p class="line891"><tt class="backtick">--tis&nbsp;[List_of_tis]</tt>        Comma separated list of inversion times in the data (in seconds), e.g. <tt class="backtick">--tis&nbsp;0.2,0.4,0.6</tt>. <span class="anchor" id="line-367"></span></li><li><p class="line891"><tt class="backtick">--fa&nbsp;[Flip_angle]</tt>  Flip angle in degrees for Look-Locker readouts, do not set if not using Look-Locker. <span class="anchor" id="line-368"></span></li><li><p class="line891"><tt class="backtick">--lfa&nbsp;[Low_flip_angle]</tt>     Low flip angle for Look-Lokcer readouts in which an extra set of TIs were acquired with a lower flip angle. This is used to estimate the correction for true flip angle at every voxel. It is assumed that the low flip angle data is the final phase (set of TIs) in the calibration data. <span class="anchor" id="line-369"></span></li><li><p class="line891"><tt class="backtick">--nphases&nbsp;[number_of_phases]</tt>       The number of phases (sets of TIs) at the higher flip angle. <span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span></li></ul><p class="line867">
<h2 id="A.27Tissue.27_reference_type">'Tissue' reference type</h2>
<span class="anchor" id="line-372"></span><p class="line867"><tt class="backtick">asl_calib</tt> will let you choose what 'tissue' you want to use as the reference. M0 is calculated within a mask of this 'tissue', as the mean over all the voxels within the mask. This option tells <tt class="backtick">asl_calib</tt> which 'tissue' from the automatic segmentation as well as what T1 and T2(*) values should be used. <span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><p class="line862">By default <tt class="backtick">asl_calib</tt> uses CSF as the reference because it is relatively easy to segment and a mask can be defined containing a reasonable number of voxels that do not suffer substantial partial volume effects. The automated masking is optimized to extract CSF from the ventricles and thus is probably the best reference to use. White matter is a reasonable alternative as partial volume effects can be minimized to a good degree. Grey matter is generally not a good option for that reason. <span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><p class="line867">
<h2 id="Automatic_reference_.27tissue.27_mask">Automatic reference 'tissue' mask</h2>
<span class="anchor" id="line-377"></span><p class="line867"><tt class="backtick">asl_calib</tt> attempts to automatically generate the reference 'tissue' mask from the structural image, unless you supply your own custom mask with the <tt class="backtick">-m</tt> option. It does this using <tt class="backtick">FAST</tt>, thus the normal caveats for segmentation when using that program apply, for example the structural image must already have been brain extracted. <span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><p class="line862">Having a really perfect mask is not vital, since the calibration is performed over all the voxels within the mask. However, the mask needs to at least be sensible, hence it is a very good idea to check the mask created at the end to see if it is sensible. If <tt class="backtick">asl_calib</tt> detects that after segmentation, transformation into ASL native space and thresholding, that there are no voxels in the mask it will halt and tell you that the automated method has failed. <span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><p class="line867">
<h2 id="Using_M0_and_sensitivity_images_to_calculate_absolute_CBF">Using M0 and sensitivity images to calculate absolute CBF</h2>
<span class="anchor" id="line-382"></span><p class="line867"><tt class="backtick">asl_calib</tt> can be instructed to save the M0 value and the sensitivity image (if calcuated) for subsequent use to calculate absolute CBF. Given an estimated CBF image, e.g. from BASIL, absolute CBF in ml/100g/min can be obtained using <tt class="backtick">fslmaths</tt>: <span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><ul><li><p class="line862">With M0 only: <tt class="backtick">fslmaths&nbsp;[CBF_image]&nbsp;-div&nbsp;</tt>cat [M0_text_file]<tt class="backtick">&nbsp;-mul&nbsp;6000&nbsp;[absolute_CBF_output_image]</tt>. <span class="anchor" id="line-385"></span></li><li><p class="line862">With M0 and sensitivity image: <tt class="backtick">fslmaths&nbsp;[CBF_image]&nbsp;-div&nbsp;</tt>cat [M0_text_file]<tt class="backtick">&nbsp;-div&nbsp;[sensitivity_image]&nbsp;-mul&nbsp;6000&nbsp;[absolute_CBF_output_image]</tt>. <span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span></li></ul><p class="line874">For these calculations the CBF image should still be in the native resolution of the ASL data. The first option (with M0 only) will work with CBF images that have been converted to an another resolution, e.g. standard space. <span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-390"></span>
<h1 id="Data_assembly_.26_tag-control_subtraction_.28asl_file.29">Data assembly &amp; tag-control subtraction (asl_file)</h1>
<span class="anchor" id="line-391"></span><p class="line867"><tt class="backtick">asl_file</tt> allows for some basic file manipulation to get the data in a form suitable for oxford_asl. Primarily this will be to perform tag-control subtraction, but it may also be necessary to get the data into the right order and to take the mean of individual repeats within each TI. <span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><p class="line862">It is possible to use sinc-subtraction rather than direct subtraction using the <tt class="backtick">perfusion_subtract</tt> command. However, it is important to do this process individually within each TI (not in a single process on the whole data), this can be achieved using a combination of <tt class="backtick">asl_file</tt> (to split the data up) and <tt class="backtick">fslmerge</tt> to combine it back together after subtraction. <span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-396"></span><a href="./CategoryBASIL.html">CategoryBASIL</a> <span class="anchor" id="line-397"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2014-07-08 15:31
</body>
</html>
